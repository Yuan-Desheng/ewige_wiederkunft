---
topicCardFilter: ""
searchText: ""
searchTag: ""
startDate: ""
endDate: ""
showPermanentNotes: true
showProjectNotes: true
showFlashNotes: true
areaPath: Documents/I.P.A.R.A
customField: []
navigationPage:
  - "[[Assistants/Templater/ä¸»é¡µ/homepage-ä¸»é¡µ|ä¸»é¡µHome]]"
  - "[[ä»Šæ—¥éœ€å¤„ç†çš„ç¬”è®°.md|å¾…å¤„ç†ç¬”è®°]]"
  - "[[homepage-ä¸»é¡µ-è§‚å½±.md|è§‚å½±ä¸»é¡µ]]"
  - "[[ğŸ“šç”µå­ä¹¦æ¶.md|ç”µå­ä¹¦æ¶]]"
  - "[[æ¨¡å—ã€æ¨¡æ¿æ•°æ®åº“-Bases.base|æ¨¡æ¿æ•°æ®åº“]]"
  - "[[æ–‡æ¡£æ•°æ®åº“-Bases.base|æ–‡æ¡£æ•°æ®åº“]]"
  - "[[äººè„‰ç®¡ç†æ•°æ®åº“-Bases.base|äººè„‰æ•°æ®åº“]]"
---
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sailboat-icon lucide-sailboat"><path d="M10 2v15"/><path d="M7 22a4 4 0 0 1-4-4 1 1 0 0 1 1-1h16a1 1 0 0 1 1 1 4 4 0 0 1-4 4z"/><path d="M9.159 2.46a1 1 0 0 1 1.521-.193l9.977 8.98A1 1 0 0 1 20 13H4a1 1 0 0 1-.824-1.567z"/></svg>`INPUT[inlineListSuggester(option([[homepage-ä¸»é¡µ|ä¸»é¡µ]]), option([[homepage-ä¸»é¡µ-è¿œç¨‹æ¨é€æ›´æ–°|æ›´æ–°ä»“åº“]]), option([[Dataview-readingnote|é˜…è¯»ä¸»é¡µ]]),allowOther):navigationPage]`
```col-md
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-text-search-icon lucide-text-search"><path d="M21 5H3"/><path d="M10 12H3"/><path d="M10 19H3"/><circle cx="17" cy="15" r="3"/><path d="m21 19-1.9-1.9"/></svg>`INPUT[text(placeholder(æœç´¢ç¬”è®°å),class(text-datacore)):searchText]` <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lightbulb-icon lucide-lightbulb"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>`INPUT[toggle:showFlashNotes]` <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-folder-kanban-icon lucide-folder-kanban"><path d="M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z"/><path d="M8 10v4"/><path d="M12 10v2"/><path d="M16 10v6"/></svg>`INPUT[toggle:showProjectNotes]` <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shredder-icon lucide-shredder"><path d="M10 22v-5"/><path d="M14 19v-2"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M18 20v-3"/><path d="M2 13h20"/><path d="M20 13V7l-5-5H6a2 2 0 0 0-2 2v9"/><path d="M6 20v-3"/></svg>`INPUT[toggle:showPermanentNotes]` <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-json-icon lucide-file-json"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1"/><path d="M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1"/></svg>è‡ªå®šä¹‰å­—æ®µ`INPUT[inlineList:customField]` 
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tags-icon lucide-tags"><path d="M13.172 2a2 2 0 0 1 1.414.586l6.71 6.71a2.4 2.4 0 0 1 0 3.408l-4.592 4.592a2.4 2.4 0 0 1-3.408 0l-6.71-6.71A2 2 0 0 1 6 9.172V3a1 1 0 0 1 1-1z"/><path d="M2 7v6.172a2 2 0 0 0 .586 1.414l6.71 6.71a2.4 2.4 0 0 0 3.191.193"/><circle cx="10.5" cy="6.5" r=".5" fill="currentColor"/></svg>`INPUT[text(placeholder(æœç´¢æ ‡ç­¾å),class(text-datacore)):searchTag]` `INPUT[datePicker(defaultValue(null)):startDate]`â†’ `INPUT[datePicker(defaultValue(null)):endDate]` <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-land-plot-icon lucide-land-plot"><path d="m12 8 6-3-6-3v10"/><path d="m8 11.99-5.5 3.14a1 1 0 0 0 0 1.74l8.5 4.86a2 2 0 0 0 2 0l8.5-4.86a1 1 0 0 0 0-1.74L16 12"/><path d="m6.49 12.85 11.02 6.3"/><path d="M17.51 12.85 6.5 19.15"/></svg>`INPUT[inlineSelect(option(Documents/I.P.A.R.A,æ‰€æœ‰é¢†åŸŸ), option(Documents/I.P.A.R.A/å­¦ä¹ é¢†åŸŸ,å­¦ä¹ é¢†åŸŸ), option(Documents/I.P.A.R.A/å·¥ä½œé¢†åŸŸ,å·¥ä½œé¢†åŸŸ),option(Documents/I.P.A.R.A/ç”Ÿæ´»é¢†åŸŸ,ç”Ÿæ´»é¢†åŸŸ)):areaPath]`   <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard-icon lucide-layout-dashboard"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>`BUTTON[topic-filter]` `BUTTON[resetDatabase]`
```

```datacorejsx
// å®šä¹‰è¡¨æ ¼åˆ—
function getColumns(customFields) {
    const baseColumns = [
        { 
            id: "ç¬”è®°åç§°", 
            value: page => page.$link 
        },
        { 
            id: "ç¬”è®°ç±»å‹", 
            value: page => {
                const noteType = page.value("ç¬”è®°ç±»å‹") || "æœªåˆ†ç±»";
                return (
                    <span style={{ whiteSpace: 'nowrap' }}>
                        {noteType}
                    </span>
                );
            }
        },
        { 
            id: "ç¬”è®°ä¸»é¢˜", 
            value: page => page.value("å¡ç‰‡ç›’ç¬”è®°ä¸»é¢˜")
        },
        { 
            id: "æ ‡ç­¾", 
            value: (page) => { 
                const tags = page.value("tags"); 
                if (!tags) return ""; 
                
                // å®šä¹‰æ ‡ç­¾ç‚¹å‡»å¤„ç†å‡½æ•° 
                const handleTagClick = (tag) => { 
                    const app = window.app; 
                    const file = app.workspace.getActiveFile(); 
                    if (file) { 
                        app.fileManager.processFrontMatter(file, (frontmatter) => { 
                            frontmatter.searchTag = tag; 
                        }); 
                    } 
                }; 
                
                // ç”Ÿæˆæ ‡ç­¾é¢œè‰²çš„å‡½æ•° 
                const generateTagColor = (tagText) => { 
                    // ç®€å•å“ˆå¸Œå‡½æ•° 
                    let hash = 0; 
                    for (let i = 0; i < tagText.length; i++) { 
                        const char = tagText.charCodeAt(i); 
                        hash = ((hash << 5) - hash) + char; 
                        hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•° 
                    } 
                    
                    // ç”ŸæˆæŸ”å’Œçš„é¢œè‰² 
                    const hue = Math.abs(hash) % 360; 
                    const saturation = 45 + (Math.abs(hash) % 25); // 45-70% 
                    const lightness = 75 + (Math.abs(hash) % 15); // 75-90% 
                    
                    const backgroundColor = `hsl(${hue}, ${saturation}%, ${lightness}%)`; 
                    const borderColor = `hsl(${hue}, ${saturation + 10}%, ${lightness - 15}%)`; 
                    const hoverColor = `hsl(${hue}, ${saturation + 5}%, ${lightness - 8}%)`; 
                    
                    return { backgroundColor, borderColor, hoverColor }; 
                }; 
                
                if (Array.isArray(tags)) { 
                    return ( 
                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px' }}> 
                            {tags.map((tag, index) => { 
                                const colors = generateTagColor(tag); 
                                return ( 
                                    <button 
                                        key={index} 
                                        onClick={() => handleTagClick(tag)} 
                                        style={{ 
                                            height: '20px', 
                                            fontSize: '11px', 
                                            backgroundColor: colors.backgroundColor, 
                                            borderRadius: '14px', 
                                            cursor: 'pointer', 
                                            color: '#2c3e50', 
                                            transition: 'all 0.2s ease', 
                                            boxShadow: '0 1px 2px rgba(0,0,0,0.1)' 
                                        }} 
                                        onMouseOver={(e) => { 
                                            e.target.style.backgroundColor = colors.hoverColor; 
                                            e.target.style.transform = 'translateY(-1px)'; 
                                            e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.15)'; 
                                        }} 
                                        onMouseOut={(e) => { 
                                            e.target.style.backgroundColor = colors.backgroundColor; 
                                            e.target.style.transform = 'translateY(0)'; 
                                            e.target.style.boxShadow = '0 1px 2px rgba(0,0,0,0.1)'; 
                                        }} 
                                    > 
                                        {tag} 
                                    </button> 
                                ); 
                            })} 
                        </div> 
                    ); 
                } else { 
                    const colors = generateTagColor(tags); 
                    return ( 
                        <button 
                            onClick={() => handleTagClick(tags)} 
                            style={{ 
                                padding: '3px 8px', 
                                fontSize: '12px', 
                                backgroundColor: colors.backgroundColor, 
                                border: `1px solid ${colors.borderColor}`, 
                                borderRadius: '12px', 
                                cursor: 'pointer', 
                                color: '#2c3e50', 
                                fontWeight: '500', 
                                transition: 'all 0.2s ease', 
                                boxShadow: '0 1px 2px rgba(0,0,0,0.1)' 
                            }} 
                            onMouseOver={(e) => { 
                                e.target.style.backgroundColor = colors.hoverColor; 
                                e.target.style.transform = 'translateY(-1px)'; 
                                e.target.style.boxShadow = '0 2px 4px rgba(0,0,0,0.15)'; 
                            }} 
                            onMouseOut={(e) => { 
                                e.target.style.backgroundColor = colors.backgroundColor; 
                                e.target.style.transform = 'translateY(0)'; 
                                e.target.style.boxShadow = '0 1px 2px rgba(0,0,0,0.1)'; 
                            }} 
                        > 
                            {tags} 
                        </button> 
                    ); 
                } 
            } 
        }];
        
    
    // å¦‚æœcustomFieldsæ˜¯æ•°ç»„ä¸”æœ‰å€¼ï¼Œä¸ºæ¯ä¸ªå­—æ®µæ·»åŠ åˆ—
    if (Array.isArray(customFields) && customFields.length > 0) {
        customFields.forEach(fieldName => {
            if (fieldName && fieldName.trim()) {
                baseColumns.push({
                     id: fieldName,
                     width: "12%",
                     value: page => {
                         const fieldValue = page.value(fieldName);
                         return fieldValue || "";
                     }
                 });
            }
        });
    }
    
    // æ·»åŠ è¿›åº¦åˆ—
    baseColumns.push({
        id: "è¿›åº¦",
        width: "10%",
        value: (page) => {
            return <ProgressCell page={page} />;
        }
    });
    return baseColumns;
}

// ä¿æŒå‘åå…¼å®¹çš„COLUMNSå¸¸é‡
const COLUMNS = getColumns();

// è¿›åº¦æ¡ç»„ä»¶
function ProgressCell({ page }) {
    const [progressData, setProgressData] = dc.useState(null);
    const [loading, setLoading] = dc.useState(true);
    const [error, setError] = dc.useState(null);
    
    dc.useEffect(() => {
        async function loadProgress() {
            try {
                setLoading(true);
                setError(null);
                
                // è·å–æ–‡ä»¶å†…å®¹
                const file = app.vault.getAbstractFileByPath(page.$path);
                if (!file) {
                    setError('æ–‡ä»¶ä¸å­˜åœ¨');
                    return;
                }
                
                const content = await app.vault.cachedRead(file);
                const progressMatches = [...content.matchAll(
                    /<progress\b[^>]*value\s*=\s*["'](\d+)["'][^>]*max\s*=\s*["'](\d+)["'][^>]*>/gi
                )];
                
                if (progressMatches.length > 0) {
                    const match = progressMatches[0];
                    const value = match[1];
                    const max = match[2];
                    // ç›´æ¥è¿”å›åŒ¹é…åˆ°çš„HTMLå­—ç¬¦ä¸²
                    setProgressData(match[0]);
                } else {
                    setProgressData(null);
                }
            } catch (err) {
                setError('è¯»å–å‡ºé”™');
            } finally {
                setLoading(false);
            }
        }
        
        loadProgress();
    }, [page.$path]);
    
    if (loading) {
        return (
            <span style={{
                color: '#999',
                fontSize: '12px',
                fontStyle: 'italic'
            }}>åŠ è½½ä¸­...</span>
        );
    }
    
    if (error) {
        return (
            <span style={{
                color: '#f00',
                fontSize: '12px',
                fontStyle: 'italic'
            }}>{error}</span>
        );
    }
    
    if (progressData) {
        return (
            <div style={{ whiteSpace: 'nowrap' }} dangerouslySetInnerHTML={{
                __html: progressData
            }} />
        );
    }
    
    return (
        <span style={{
            color: '#999',
            fontSize: '12px',
            fontStyle: 'italic',
            whiteSpace: 'nowrap'
        }}>--</span>
    );
}

return function View() {
    const currentFile = dc.useCurrentFile();
    const topicCardFilter = currentFile?.value("topicCardFilter") || "";
    const queryString = dc.useMemo(() => {
        const areaPath = currentFile?.value("areaPath") || "";
        // æ„å»ºåŸºç¡€æŸ¥è¯¢ï¼š@pageè‡ªåŠ¨é™åˆ¶ä¸ºé¡µé¢æ–‡ä»¶ï¼ˆmdæ–‡ä»¶ï¼‰
        let baseQuery = '@page';
        // æ ¹æ®YAMLåŒºåŸŸçš„areaPathå­—æ®µå€¼ç¡®å®šæŸ¥è¯¢èŒƒå›´
        if (areaPath) {
            baseQuery += ` and $path.contains("${areaPath}")`;
        }
        
        if (topicCardFilter && topicCardFilter.trim()) {
            const fullFileName = topicCardFilter.split('/').pop();
            const baseFileName = fullFileName.replace(/\.(md|canvas)$/, '');
            return `${baseQuery} and (linkedfrom([[${fullFileName}]]) or linkedfrom([[${baseFileName}]]) or connected([[${fullFileName}]]) or connected([[${baseFileName}]]))`;
        } else {
            return baseQuery;
        }
    }, [topicCardFilter, currentFile?.value("areaPath")]);
    
    // ä½¿ç”¨åŠ¨æ€æŸ¥è¯¢å­—ç¬¦ä¸²æ‰§è¡ŒæŸ¥è¯¢
    const queryResult = dc.useQuery(queryString);
    
    // æ·»åŠ è°ƒè¯•æ—¥å¿—éªŒè¯æŸ¥è¯¢ç»“æœ
    dc.useEffect(() => {
        if (queryResult && queryResult.length > 0) {
        }
    }, [queryString, queryResult]);
    
    // å¯¹æŸ¥è¯¢ç»“æœæŒ‰ä¿®æ”¹æ—¶é—´é™åºæ’åº
    const allPages = dc.useMemo(() => {
        if (!queryResult || queryResult.length === 0) return [];
        return [...queryResult].sort((a, b) => {
            const aTime = a.$mtime || a.file?.mtime || 0;
            const bTime = b.$mtime || b.file?.mtime || 0;
            return new Date(bTime) - new Date(aTime);
        });
    }, [queryResult]);
    
    // ä½¿ç”¨useMemoè¿›è¡Œæ•°æ®ç­›é€‰ï¼Œæé«˜æ€§èƒ½
    const filteredPages = dc.useMemo(() => {
        let filtered = allPages;
        
        // è·å–ç­›é€‰æ¡ä»¶
        const searchText = currentFile?.value("searchText") || "";
        const searchTag = currentFile?.value("searchTag") || "";
        const startDate = currentFile?.value("startDate") || "";
        const endDate = currentFile?.value("endDate") || "";
        const showPermanentNotes = currentFile?.value("showPermanentNotes") ?? true;
        const showProjectNotes = currentFile?.value("showProjectNotes") ?? true;
        const showFlashNotes = currentFile?.value("showFlashNotes") ?? true;
        const areaPath = currentFile?.value("areaPath") || "";
  
        // æ–‡æœ¬æœç´¢ç­›é€‰
        if (searchText && searchText.trim()) {
            const searchTerms = searchText.toLowerCase().split(/[\s,ï¼Œ]+/).filter(term => term.length > 0);
            filtered = filtered.filter(page => {
                const title = (page.$name || "").toLowerCase();
                const content = (page.$content || "").toLowerCase();
                const matches = searchTerms.some(term => 
                    title.includes(term) || content.includes(term)
                );
                return matches;
            });
        }
        
        // æ ‡ç­¾ç­›é€‰
        if (searchTag && searchTag.trim()) {
            const searchTags = searchTag.toLowerCase().split(/[\s,ï¼Œ]+/).filter(tag => tag.length > 0);
            filtered = filtered.filter(page => {
                const pageTags = page.value("tags") || [];
                const pageTagsArray = Array.isArray(pageTags) ? pageTags : [pageTags];
                const pageTagsLower = pageTagsArray.map(tag => String(tag).toLowerCase());
                const matches = searchTags.some(searchTag => 
                    pageTagsLower.some(pageTag => pageTag.includes(searchTag))
                );
                return matches;
            });
        }
        
        // ç¬”è®°ç±»å‹ç­›é€‰
        filtered = filtered.filter(page => {
            const noteType = page.value("ç¬”è®°ç±»å‹") || "";
            if (noteType === "æ°¸ä¹…ç¬”è®°" && !showPermanentNotes) return false;
            if (noteType === "é¡¹ç›®ç¬”è®°" && !showProjectNotes) return false;
            if (noteType === "é—ªå¿µç¬”è®°" && !showFlashNotes) return false;
            return true;
        });
        
        // æ—¥æœŸèŒƒå›´ç­›é€‰ï¼ˆåŸºäºæ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼‰
        if (startDate || endDate) {
            filtered = filtered.filter(page => {
                const modifiedTime = page.$mtime || page.file?.mtime;
                if (!modifiedTime) return false;
                
                try {
                    const pageDate = new Date(modifiedTime);
                    if (startDate && pageDate < new Date(startDate)) return false;
                    if (endDate && pageDate > new Date(endDate)) return false;
                    return true;
                } catch {
                    return false;
                }
            });
        }
        return filtered;
    }, [
        allPages,
        currentFile?.value("searchText"),
        currentFile?.value("searchTag"),
        currentFile?.value("startDate"),
        currentFile?.value("endDate"),
        currentFile?.value("showPermanentNotes"),
        currentFile?.value("showProjectNotes"),
        currentFile?.value("showFlashNotes"),
        currentFile?.value("areaPath")
    ]);

    // è·å–customFieldçš„å€¼ï¼ˆæ•°ç»„æ ¼å¼ï¼‰
    const customFields = currentFile?.value("customField") || [];
    
    // æ ¹æ®customFieldæ•°ç»„åŠ¨æ€ç”Ÿæˆåˆ—é…ç½®
    const dynamicColumns = dc.useMemo(() => {
        return getColumns(customFields);
    }, [customFields]);
    
    // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯å’Œè¡¨æ ¼
    const filterStatus = topicCardFilter ? 
        `åå‘é“¾æ¥ç­›é€‰: ${topicCardFilter.split('/').pop()}` : 
        "æ˜¾ç¤ºæ‰€æœ‰ç¬”è®°";
    
    // ç”Ÿæˆè‡ªå®šä¹‰å­—æ®µæ˜¾ç¤ºä¿¡æ¯
    const customFieldsInfo = Array.isArray(customFields) && customFields.length > 0 ? 
        `è‡ªå®šä¹‰å­—æ®µ: ${customFields.join(', ')}` : 
        "æ— è‡ªå®šä¹‰å­—æ®µ";
   
    return (
        <div>
            <dc.Table 
                columns={dynamicColumns} 
                rows={filteredPages}
                paging={true}
            />
        </div>
    );
    
}
```
