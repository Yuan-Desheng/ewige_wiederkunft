let{Plugin,PluginSettingTab,Setting,Notice,TFile,MarkdownView}=require("obsidian"),COLOR_THEMES={"classic-blue":{h1:"rgba(59, 130, 246, 0.6)",h2:"rgba(99, 102, 241, 0.55)",h3:"rgba(139, 92, 246, 0.5)",h4:"rgba(168, 85, 247, 0.45)",h5:"rgba(192, 132, 252, 0.4)",h6:"rgba(196, 181, 253, 0.35)",highlight:"rgba(59, 130, 246, 0.15)",highlightBorder:"rgba(59, 130, 246, 0.3)",background:"rgba(var(--background-secondary-rgb), 0.85)"},"classic-main":{h1:"var(--h1-color)",h2:"var(--h2-color)",h3:"var(--h3-color)",h4:"var(--h4-color)",h5:"var(--h5-color)",h6:"var(--h6-color)",highlight:"rgba(59, 130, 246, 0.15)",highlightBorder:"rgba(59, 130, 246, 0.3)",background:"rgba(var(--background-secondary-rgb), 0.85)"},"warm-orange":{h1:"rgba(251, 146, 60, 0.6)",h2:"rgba(249, 115, 22, 0.55)",h3:"rgba(234, 88, 12, 0.5)",h4:"rgba(194, 65, 12, 0.45)",h5:"rgba(154, 52, 18, 0.4)",h6:"rgba(124, 45, 18, 0.35)",highlight:"rgba(251, 146, 60, 0.15)",highlightBorder:"rgba(251, 146, 60, 0.3)",background:"rgba(var(--background-secondary-rgb), 0.85)"},"nature-green":{h1:"rgba(34, 197, 94, 0.6)",h2:"rgba(22, 163, 74, 0.55)",h3:"rgba(21, 128, 61, 0.5)",h4:"rgba(22, 101, 52, 0.45)",h5:"rgba(20, 83, 45, 0.4)",h6:"rgba(22, 69, 39, 0.35)",highlight:"rgba(34, 197, 94, 0.15)",highlightBorder:"rgba(34, 197, 94, 0.3)",background:"rgba(var(--background-secondary-rgb), 0.85)"},"elegant-purple":{h1:"rgba(168, 85, 247, 0.6)",h2:"rgba(147, 51, 234, 0.55)",h3:"rgba(126, 34, 206, 0.5)",h4:"rgba(107, 33, 168, 0.45)",h5:"rgba(88, 28, 135, 0.4)",h6:"rgba(69, 26, 108, 0.35)",highlight:"rgba(168, 85, 247, 0.15)",highlightBorder:"rgba(168, 85, 247, 0.3)",background:"rgba(var(--background-secondary-rgb), 0.85)"},"vibrant-red":{h1:"rgba(239, 68, 68, 0.6)",h2:"rgba(220, 38, 38, 0.55)",h3:"rgba(185, 28, 28, 0.5)",h4:"rgba(153, 27, 27, 0.45)",h5:"rgba(127, 29, 29, 0.4)",h6:"rgba(105, 29, 29, 0.35)",highlight:"rgba(239, 68, 68, 0.15)",highlightBorder:"rgba(239, 68, 68, 0.3)",background:"rgba(var(--background-secondary-rgb), 0.85)"},"fresh-cyan":{h1:"rgba(6, 182, 212, 0.6)",h2:"rgba(8, 145, 178, 0.55)",h3:"rgba(14, 116, 144, 0.5)",h4:"rgba(21, 94, 117, 0.45)",h5:"rgba(22, 78, 99, 0.4)",h6:"rgba(21, 67, 96, 0.35)",highlight:"rgba(6, 182, 212, 0.15)",highlightBorder:"rgba(6, 182, 212, 0.3)",background:"rgba(var(--background-secondary-rgb), 0.85)"},"minimal-gray":{h1:"rgba(141, 141, 141, 0.7)",h2:"rgba(128, 128, 128, 0.65)",h3:"rgba(145, 145, 145, 0.6)",h4:"rgba(170, 171, 171, 0.55)",h5:"rgba(162, 162, 162, 0.61)",h6:"rgba(118, 118, 118, 0.65)",highlight:"rgba(123, 124, 127, 0.15)",highlightBorder:"rgba(122, 123, 127, 0.3)",background:"rgba(var(--background-secondary-rgb), 0.85)"}},DEFAULT_SETTINGS={syncEnabled:!0,headingToFilenameDebounce:300,filenameToHeadingDebounce:100,insertHeadingIfMissing:!0,debugMode:!0,lastSyncTime:null,syncCount:0,renameDebounceTimeout:300,syncPath:"Documents/I.P.A.R.A\nDocuments/Projects\nNotes",minimapEnabled:!0,minimapWidth:80,minimapOpacity:.5,minimapTheme:"minimal-gray",minimapAutoHide:!0,minimapPosition:"right",minimapContentChangeDebounce:200,minimapCollapsible:!0,minimapHandleWidth:10,minimapDefaultExpanded:!0,minimapBlockHeight:6,minimapBlockFontSize:6,minimapColors:COLOR_THEMES["minimal-gray"],autoAdjustCursorOnOpen:!0,minimapMobileDefaultApplied:!1},HeadingStyle={Prefix:"Prefix",Underline:"Underline"};class TitleManagerPlugin extends Plugin{constructor(){super(...arguments),this.settings=Object.assign({},DEFAULT_SETTINGS),this.syncLogs=[],this.isRenameInProgress=!1,this.headingToFilenameTimer=null,this.filenameToHeadingTimer=null,this.refreshDebounceTimer=null,this.minimap=null,this.minimapHeadings=[],this.minimapEventManager=new Map,this.scrollDebounceTimer=null,this.contentChangeDebounceTimer=null,this.cursorDebounceTimer=null,this.isDragging=!1,this.currentMarkdownView=null,this.minimapExpanded=void 0,this.tooltip=null,this.tooltipTimer=null,this.tooltipHideTimer=null,this.isPluginActivated=!1,this.statusCheckInterval=null}async onload(){await this.loadSettings(),await this.checkContentProtectionStatus()?(this.isPluginActivated=!0,await this.initializePluginFeatures(),this.registerEventListeners(),this.initMinimap(),this.addSettingTab(new TitleManagerSettingTab(this.app,this)),this.addCommands(),this.debugLog("插件已成功加载，同步功能已启用")):(this.isPluginActivated=!1,this.showActivationRequired(),this.debugLog("ContentProtection插件未激活，Title Manager功能已禁用"))}async checkContentProtectionStatus(){try{var e=this.app.plugins.plugins["obsidian-content-protection"];if(e){if(!this.app.plugins.enabledPlugins.has("obsidian-content-protection"))return!1;if(e.settings)return!0===e.settings.isActivated&&e.settings.deviceId&&0<e.settings.deviceId.trim().length&&!0===e.settings.hasBeenActivated}return await this.checkContentProtectionFile()}catch(e){return this.debugLog("检查ContentProtection插件状态时出错:",e),!1}}async checkContentProtectionFile(){try{var e,i;return this.app.plugins.enabledPlugins.has("obsidian-content-protection")?(e=await this.app.vault.adapter.read(".obsidian/plugins/obsidian-content-protection/data.json"),!0===(i=JSON.parse(e)).isActivated&&i.deviceId&&0<i.deviceId.trim().length&&!0===i.hasBeenActivated):!1}catch(e){return this.debugLog("读取ContentProtection插件配置文件时出错:",e),!1}}async checkAndUpdateStatus(){var e=await this.checkContentProtectionStatus();!e&&this.isPluginActivated?(this.isPluginActivated=!1,this.disablePluginFeatures()):e&&!this.isPluginActivated&&(this.isPluginActivated=!0,await this.initializePluginFeatures())}disablePluginFeatures(){this.debugLog("禁用Title Manager插件功能"),this.statusCheckInterval&&(clearInterval(this.statusCheckInterval),this.statusCheckInterval=null)}showActivationRequired(){this.app.plugins.enabledPlugins.has("obsidian-content-protection")?this.debugLog("ContentProtection插件已启用但未激活"):this.debugLog("ContentProtection插件未启用")}async initializePluginFeatures(){this.debugLog("初始化Title Manager插件功能"),this.statusCheckInterval=window.setInterval(()=>{this.checkAndUpdateStatus()},3e5)}isFileInSyncPath(e){if(!this.settings.syncPath||""===this.settings.syncPath.trim())return!0;var e=e.path,i=this.settings.syncPath.split("\n").map(e=>e.trim()).filter(e=>""!==e);if(0===i.length)return!0;var t,n=e.replace(/\\/g,"/");for(t of i){var s=t.replace(/\\/g,"/");if(n.startsWith(s)){s=n.substring(s.length);if(""===s||s.startsWith("/"))return!0}}return!1}shouldEnableSync(e){return!!this.isPluginActivated&&this.isFileInSyncPath(e)}async onunload(){this.statusCheckInterval&&(clearInterval(this.statusCheckInterval),this.statusCheckInterval=null),this.headingToFilenameTimer&&(clearTimeout(this.headingToFilenameTimer),this.headingToFilenameTimer=null),this.filenameToHeadingTimer&&(clearTimeout(this.filenameToHeadingTimer),this.filenameToHeadingTimer=null),this.scrollDebounceTimer&&(clearTimeout(this.scrollDebounceTimer),this.scrollDebounceTimer=null),this.refreshDebounceTimer&&(clearTimeout(this.refreshDebounceTimer),this.refreshDebounceTimer=null),this.contentChangeDebounceTimer&&(clearTimeout(this.contentChangeDebounceTimer),this.contentChangeDebounceTimer=null),this.cursorDebounceTimer&&(clearTimeout(this.cursorDebounceTimer),this.cursorDebounceTimer=null),this.tooltipTimer&&(clearTimeout(this.tooltipTimer),this.tooltipTimer=null),this.tooltipHideTimer&&(clearTimeout(this.tooltipHideTimer),this.tooltipHideTimer=null),this.hideTooltip(),this.destroyMinimap(),this.syncLogs.length=0,this.minimapHeadings.length=0}debugLog(e,i=0){this.settings.debugMode}async refreshActiveDocument(s,i=!1){try{this.debugLog(`开始刷新文档: ${s?s.path:"未知文件"}, 来源: `+(i?"标题同步":"其他")),this.refreshDebounceTimer&&(clearTimeout(this.refreshDebounceTimer),this.refreshDebounceTimer=null);let e=100;i&&(e=this.settings.headingToFilenameDebounce+150,this.debugLog(`标题同步刷新，使用延迟: ${e}ms`)),this.refreshDebounceTimer=setTimeout(async()=>{try{var i=this.app.workspace.activeLeaf;let r=i,e=null;if(this.debugLog("当前活动文件: "+(i?.view?.file?.path||"无")),this.debugLog("目标文件: "+(s?.path||"无")),s&&i?.view?.file?.path!==s.path){this.debugLog("目标文件与当前活动文件不一致，尝试查找或打开目标文件");var t=this.app.workspace.getLeavesOfType("markdown").find(e=>e.view instanceof MarkdownView&&e.view.file?.path===s.path);if(t)this.debugLog("找到现有的文件视图"),r=t,e=t.view;else{this.debugLog("未找到现有视图，尝试打开文件");try{var n=this.app.workspace.getLeaf(!1);await n.openFile(s),r=n,e=n.view,this.debugLog("成功打开文件到新视图")}catch(e){this.debugLog("打开文件失败:",e),r=i}}}if(r&&r.view instanceof MarkdownView){let a=r.view.editor;if(a){var o=a.lineCount();this.debugLog("开始扫描整个文档寻找 meta-bind-embed 代码块，总行数: "+o);try{let e=!1,n=-1,s=-1;for(let i=0;i<o;i++){var h=a.getLine(i);if(h&&h.includes("meta-bind-embed")){e=!0;for(let e=i;0<=e;e--){var l=a.getLine(e);if(l&&l.trim().startsWith("```")){n=e;break}}for(let e=i+1;e<o;e++){var g=a.getLine(e);if(g&&"```"===g.trim()){s=e;break}}break}}if(e&&0<=n&&0<=s){this.debugLog(`发现 meta-bind-embed 代码块: 第${n}行到第${s}行`);let i=r.view;i&&i.previewMode&&i.previewMode.renderer&&setTimeout(()=>{try{i.previewMode.renderer.sections.forEach(e=>{e.lineStart<=s&&e.lineEnd>=n&&(e.rendered=!1)}),i.previewMode.renderer.queueRender()}catch(e){this.debugLog("预览模式重新渲染失败:",e)}},50);var d=[];for(let e=n;e<=s;e++)d.push(a.getLine(e));let t="\x3c!-- temp-refresh-marker --\x3e";a.setLine(s,a.getLine(s)+t),setTimeout(()=>{try{var e=a.getLine(s);e&&e.includes(t)&&a.setLine(s,e.replace(t,"")),a.refresh(),setTimeout(()=>{i&&i.editor&&i.editor.refresh(),this.app.workspace.trigger("layout-change")},100)}catch(e){this.debugLog("代码块刷新过程中出错:",e)}},50),this.debugLog(`已强制刷新 meta-bind-embed 代码块 (第${n}-${s}行)`)}else a.refresh(),this.debugLog("已刷新整个文档内容，未发现 meta-bind-embed 代码块")}catch(e){a.refresh(),this.debugLog("强制刷新失败，已降级到全局刷新")}}}else this.debugLog("未找到活动的 Markdown 视图")}catch(e){this.debugLog("刷新文档时出错",e)}finally{this.refreshDebounceTimer=null}},e)}catch(e){this.debugLog("获取活动视图时出错",e)}}registerEventListeners(){this.registerEvent(this.app.vault.on("rename",(e,i)=>{this.settings.syncEnabled&&this.handleSyncFilenameToHeading(e,i)})),this.registerEvent(this.app.vault.on("modify",e=>{this.settings.syncEnabled&&this.handleSyncHeadingToFile(e)}))}addCommands(){this.addCommand({id:"sync-filename-to-heading",name:"同步文件名到标题",editorCallback:(e,i)=>{this.isPluginActivated?this.forceSyncFilenameToHeading(i.file):this.app.plugins.enabledPlugins.has("obsidian-content-protection")}}),this.addCommand({id:"sync-heading-to-filename",name:"同步标题到文件名",editorCallback:(e,i)=>{this.isPluginActivated?this.forceSyncHeadingToFilename(i.file):this.app.plugins.enabledPlugins.has("obsidian-content-protection")}})}handleSyncFilenameToHeading(e,i){this.isRenameInProgress?this.debugLog("重命名正在进行中，跳过处理"):e instanceof TFile&&"md"===e.extension&&this.shouldEnableSync(e)&&(i=i.split("/").pop().replace(".md",""),e.basename===i?this.debugLog("文件名未发生变化，跳过处理"):(this.debugLog(`文件重命名事件: ${i} -> `+e.basename),this.filenameToHeadingTimer&&clearTimeout(this.filenameToHeadingTimer),this.filenameToHeadingTimer=setTimeout(()=>{this.forceSyncFilenameToHeading(e),this.filenameToHeadingTimer=null},this.settings.filenameToHeadingDebounce)))}handleSyncHeadingToFile(e){e instanceof TFile&&"md"===e.extension&&this.shouldEnableSync(e)&&(this.app.workspace.getActiveFile()!==e?this.debugLog("非当前活动文件，跳过处理"):(this.debugLog("文件修改事件: "+e.path),this.headingToFilenameTimer&&clearTimeout(this.headingToFilenameTimer),this.headingToFilenameTimer=setTimeout(()=>{this.forceSyncHeadingToFilename(e),this.headingToFilenameTimer=null},this.settings.headingToFilenameDebounce)))}async ensureFileSaved(e){for(var i of this.app.workspace.getLeavesOfType("markdown"))i.view instanceof MarkdownView&&i.view.file===e&&i.view.dirty&&(await i.view.save(),this.debugLog("文件已保存"))}async forceSyncHeadingToFilename(i){if(this.shouldEnableSync(i)){if(null!==i)try{await this.ensureFileSaved(i);var e=(await this.app.vault.read(i)).split("\n"),t=this.findNoteStart(e),n=this.findHeading(e,t);if(null===n)this.debugLog("未找到标题，跳过同步");else{var s=this.sanitizeHeading(n.text);if(0<s.length&&this.sanitizeHeading(i.basename)!==s){var a=i.parent?.path+`/${s}.md`;this.debugLog(`准备重命名文件: ${i.path} -> `+a),this.isRenameInProgress=!0;try{var r=await this.app.fileManager.renameFile(i,a);this.logSync(i.path,"heading-to-filename",i.basename,s,!0),await this.refreshActiveDocument(r||i,!0)}catch(e){this.debugLog("重命名文件时出错",e),this.logSync(i.path,"heading-to-filename",i.basename,s,!1)}finally{this.isRenameInProgress=!1}}}}catch(e){this.debugLog("同步标题到文件名时出错",e)}}else this.isPluginActivated?this.isFileInSyncPath(i)||new Notice("文件不在同步路径范围内："+this.settings.syncPath):this.showActivationRequired()}async forceSyncFilenameToHeading(e){if(this.shouldEnableSync(e)){if(null!==e)try{await this.ensureFileSaved(e);var i=this.sanitizeHeading(e.basename),t=(await this.app.vault.read(e)).split("\n"),n=this.findNoteStart(t),s=this.findHeading(t,n);null!==s?this.sanitizeHeading(s.text)!==i&&(this.debugLog(`替换现有标题: ${s.text} -> `+i),this.replaceHeading(e,t,s.lineNumber,s.style,i,s),this.logSync(e.path,"filename-to-heading",s.text,i,!0),await this.refreshActiveDocument(e)):this.settings.insertHeadingIfMissing&&(this.debugLog("插入新标题: "+i),this.insertHeading(e,t,n,i),this.logSync(e.path,"filename-to-heading","(无标题)",i,!0),await this.refreshActiveDocument(e))}catch(e){this.debugLog("同步文件名到标题时出错",e)}}else this.isPluginActivated?this.isFileInSyncPath(e)||new Notice("文件不在同步路径范围内："+this.settings.syncPath):this.showActivationRequired()}findNoteStart(i){if("---"===i[0])for(let e=1;e<i.length;e++)if("---"===i[e])return e+1;return 0}findHeading(i,t){let n=!1;for(let e=t;e<i.length;e++){var s=i[e].trimEnd();if(s.trim().startsWith("```"))n=!n;else if(!n){var a=s.match(/^(#{1,6})\s+(.+)$/);if(a){var r=(s.match(/`/g)||[]).length;if(r%2==0&&!s.startsWith("\\#"))return{lineNumber:e,text:a[2],level:a[1].length,prefix:a[1],style:HeadingStyle.Prefix}}if(void 0!==i[e+1]&&null!==i[e+1].trim().match(/^=+$/)&&0<s.length)if((s.match(/`/g)||[]).length%2==0)return{lineNumber:e,text:s,level:1,prefix:"#",style:HeadingStyle.Underline}}}return null}sanitizeHeading(e){return(e=e.replace(/[\\/:|#^[\]]/g,"")).trim()}insertHeading(e,i,t,n){this.insertLineInFile(e,i,t,"# "+n)}replaceHeading(e,i,t,n,s,a=null){switch(n){case HeadingStyle.Underline:this.replaceLineInFile(e,i,t,""+s);break;case HeadingStyle.Prefix:var r=a?.prefix||"#";this.replaceLineInFile(e,i,t,r+" "+s)}}replaceLineInFile(e,i,t,n){t>=i.length?i.push(n+"\n"):i[t]=n;t=i.join("\n");this.app.vault.modify(e,t)}insertLineInFile(e,i,t,n){t>=i.length?i.push(n+"\n"):i.splice(t,0,n);t=i.join("\n");this.app.vault.modify(e,t)}logSync(e,i,t,n,s){e={id:Date.now().toString(),filePath:e,operation:i,oldValue:t,newValue:n,timestamp:new Date,success:s};this.syncLogs.unshift(e),100<this.syncLogs.length&&(this.syncLogs=this.syncLogs.slice(0,100)),s&&(this.settings.syncCount++,this.settings.lastSyncTime=(new Date).toISOString(),this.saveSettings()),this.debugLog("记录同步日志",e)}initMinimap(){this.debugLog("初始化迷你地图功能（事件监听始终启用）"),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.handleActiveLeafChange()})),this.registerEvent(this.app.workspace.on("file-open",e=>{this.handleFileOpen(e)})),this.handleActiveLeafChange()}destroyMinimap(){this.debugLog("销毁迷你地图"),this.minimap&&(this.minimap.remove(),this.minimap=null),this.clearMinimapEventListeners(),this.currentMarkdownView=null,this.minimapHeadings.length=0,this.isDragging=!1}handleActiveLeafChange(){var e=this.app.workspace.activeLeaf;e&&e.view instanceof MarkdownView?(this.currentMarkdownView=e.view,setTimeout(()=>{this.updateMinimap(),this.autoAdjustCursorOnOpen()},100)):(e=this.app.workspace.getLeavesOfType("markdown").find(e=>e.view instanceof MarkdownView))?(this.currentMarkdownView=e.view,setTimeout(()=>{this.updateMinimap(),this.autoAdjustCursorOnOpen()},100),this.debugLog("窗口失去焦点，但保持迷你地图显示，因为仍有 Markdown 文档打开")):(this.currentMarkdownView=null,this.hideMinimap(),this.debugLog("没有打开的 Markdown 文档，隐藏迷你地图"))}handleFileOpen(e){e&&"md"===e.extension?setTimeout(()=>{this.updateMinimap(),this.autoAdjustCursorOnOpen()},100):this.hideMinimap()}async updateMinimap(){try{if(this.app&&this.app.isMobile)return void this.hideMinimap()}catch(e){}if(this.settings.minimapEnabled&&this.currentMarkdownView)try{var e=this.currentMarkdownView.editor.getValue();this.minimapHeadings=this.parseHeadingStructure(e),0===this.minimapHeadings.length?this.hideMinimap():(this.createMinimapDOM(),this.renderHeadingBlocks(),this.setupMinimapEventListeners(),this.updateCurrentHeadingHighlight(),this.debugLog(`迷你地图已更新，包含 ${this.minimapHeadings.length} 个标题`))}catch(e){this.debugLog("更新迷你地图时出错",e)}else this.hideMinimap()}parseHeadingStructure(e){var i=[],t=e.split("\n");let n=!1,s="";for(let e=0;e<t.length;e++){var a=t[e].trim(),r=a.match(/^(`{3,}|~{3,})/);r?(r=r[1],n?r[0]===s&&3<=r.length&&(n=!1,s=""):(n=!0,s=r[0])):n||(r=a.match(/^(#{1,6})\s+(.+)$/))&&(a=r[1].length,r=r[2].trim(),i.push({level:a,text:r,line:e+1,position:this.getLinePosition(t,e)}))}return i}getLinePosition(i,t){let n=0;for(let e=0;e<t;e++)n+=i[e].length+1;return n}createMinimapDOM(){if(this.minimap&&(t=this.minimapExpanded,this.minimap.remove(),this.minimapExpanded=t),this.currentMarkdownView){var t=this.currentMarkdownView.containerEl;if(t){this.minimap=document.createElement("div"),this.minimap.className="title-manager-minimap";var n=this.settings.minimapHandleWidth;let e="left"===this.settings.minimapPosition,i=(this.settings.minimapCollapsible&&void 0===this.minimapExpanded&&(this.minimapExpanded=this.settings.minimapDefaultExpanded),"translateX(0px)");this.settings.minimapCollapsible&&!this.minimapExpanded&&(s=this.settings.minimapWidth,i=e?`translateX(-${s}px)`:`translateX(${s}px)`);var s=e?"left: 20px;":"right: 20px;";if(this.minimap.style.cssText=`
            position: absolute;
            width: ${this.settings.minimapWidth}px;
            background: ${this.settings.minimapColors.background};
            border-radius: 8px;
            opacity: ${this.settings.minimapOpacity};
            z-index: 1000;
            overflow: visible;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.2s ease;
            pointer-events: auto;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            will-change: transform;
            transform: ${i};
            ${s}
        `,this.settings.minimapCollapsible){s=document.createElement("div");s.className="minimap-handle";let e="left"===this.settings.minimapPosition;var a=e?"right: 0;":"left: 0;",r=e?"0 4px 4px 0":"4px 0 0 4px",o=e?"border-left: none;":"border-right: none;";s.style.cssText=`
                position: absolute;
                ${a}
                top: 50%;
                transform: translateY(-50%);
                width: ${n}px;
                height: 100px;
                background: var(--background-secondary);
                border-radius: ${r};
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                border: 1px solid rgba(255, 255, 255, 0.08);
                ${o}
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
                z-index: 1001;
            `;let i;i=e?this.minimapExpanded?"M5 1L1 6L5 11":"M1 1L5 6L1 11":this.minimapExpanded?"M1 1L5 6L1 11":"M5 1L1 6L5 11",s.innerHTML=`
                <svg width="6" height="12" viewBox="0 0 6 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="${i}" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            `,s.addEventListener("click",e=>{e.stopPropagation(),this.toggleMinimapCollapse()}),this.minimap.appendChild(s)}a=document.createElement("div");a.className="minimap-headings",a.style.cssText=`
            position: relative;
            width: 100%;
            height: 100%;
            padding: 4px;
            overflow: hidden;
        `,this.minimap.appendChild(a),t.style.position="relative",t.appendChild(this.minimap),this.updateMinimapPosition()}}}renderHeadingBlocks(){let o=this.minimap.querySelector(".minimap-headings");if(o){o.innerHTML="";var e=this.minimap.clientHeight-8;let n=e/this.currentMarkdownView.editor.lineCount(),s=[],a=0;this.minimapHeadings.forEach((e,i)=>{let t=(e.line-1)*n;0<i&&t<a+8&&(t=a+8);i=Math.max(2,6-e.level);s.push({heading:e,top:t,height:i,width:Math.max(30,90-10*(e.level-1))}),a=t+i});var i=a;n;let r;e<i&&(r=e/i,a=0,s.forEach((e,i)=>{let t=e.top*r;var n=8*r;0<i&&t<a+n&&(t=a+n),e.top=t,e.height=e.height*r,a=t+e.height})),s.forEach((e,i)=>{let t=document.createElement("div");t.className="heading-block h"+e.heading.level,t.dataset.line=e.heading.line.toString(),t.dataset.index=i.toString();var i="left"===this.settings.minimapPosition,n=i?"left: 4px;":"right: 4px;",i=i?"flex-start":"flex-end",s=(Math.max(8,Math.min(12,.6*e.height)),e.height);t.style.cssText=`
                position: absolute;
                top: ${e.top}px;
                ${n}
                width: ${e.width}%;
                height: ${e.height}px;
                background: ${this.settings.minimapColors["h"+e.heading.level]};
                cursor: pointer;
                display: flex;
                align-items: center;
                padding: 0px 4px;
                font-size: ${this.settings.minimapBlockFontSize}px;
                line-height: ${s}px;
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
                box-sizing: border-box;
                justify-content:${i};
            `,t.textContent=e.heading.text,t.addEventListener("mouseenter",()=>{t.classList.add("heading-block-hover")}),t.addEventListener("mouseleave",()=>{t.classList.remove("heading-block-hover")}),o.appendChild(t)}),this.updateCurrentHeadingHighlight()}}setupMinimapEventListeners(){if(this.minimap&&this.currentMarkdownView){this.clearMinimapEventListeners();let t=this.currentMarkdownView.editor;var e=this.currentMarkdownView.containerEl.querySelector(".cm-scroller");if(e){var n=()=>{this.scrollDebounceTimer&&clearTimeout(this.scrollDebounceTimer),this.scrollDebounceTimer=setTimeout(()=>{this.updateCurrentHeadingHighlight()},16)},e=(e.addEventListener("scroll",n,{passive:!0}),this.minimapEventManager.set("scroll",{element:e,handler:n}),()=>{this.updateMinimapPosition()}),n=(window.addEventListener("resize",e),this.minimapEventManager.set("resize",{element:window,handler:e}),this.minimap.querySelector(".minimap-headings")),e=e=>{e=e.target.closest(".heading-block");if(e&&e.dataset.line){e=parseInt(e.dataset.line)-1;if(!(isNaN(e)||e<0))try{this.scrollToLineCenter(t,e)}catch(e){}}};n.addEventListener("click",e),this.minimapEventManager.set("click",{element:n,handler:e});let i=()=>{this.contentChangeDebounceTimer&&clearTimeout(this.contentChangeDebounceTimer),this.contentChangeDebounceTimer=setTimeout(()=>{this.updateMinimap(),this.contentChangeDebounceTimer=null},this.settings.minimapContentChangeDebounce)};n=this.registerEvent(this.app.vault.on("modify",e=>{e===this.app.workspace.getActiveFile()&&i()}));this.minimapEventManager.set("content-change",{element:null,handler:n}),this.setupCursorPositionListener()}}}hasHeadingChanges(e){if(e&&Array.isArray(e))for(var i of e){var t=i.from.line,n=i.to.line;for(let e=t;e<=n;e++){var s=this.currentMarkdownView.editor.getLine(e);if(s&&this.isHeadingLine(s))return!0}if(i.text&&Array.isArray(i.text))for(var a of i.text)if(this.isHeadingLine(a))return!0}return!1}isHeadingLine(e){return!(!e||"string"!=typeof e)&&(e=e.trim(),/^#{1,6}\s+.+$/.test(e))}setupCursorPositionListener(){if(this.currentMarkdownView&&this.currentMarkdownView.editor){var e=this.currentMarkdownView.editor,i=this.currentMarkdownView.containerEl;this.debugLog("设置光标位置监听器");let t=(e="unknown")=>{this.debugLog("光标事件触发: "+e),this.cursorDebounceTimer&&clearTimeout(this.cursorDebounceTimer),this.cursorDebounceTimer=setTimeout(()=>{this.debugLog(`执行光标高亮更新 (来源: ${e})`),this.updateCurrentHeadingHighlight()},20)};var n=this.registerEvent(this.app.workspace.on("editor-change",(e,i)=>{e===this.currentMarkdownView?.editor&&t("editor-change")})),e=(this.registerEvent(this.app.workspace.on("active-leaf-change",e=>{e?.view?.editor===this.currentMarkdownView?.editor&&t("active-leaf-change")})),e.cm&&e.cm.on&&(e.cm.on("cursorActivity",s=()=>t("codemirror-cursor")),this.minimapEventManager.set("cursor-cm",{element:e.cm,handler:s,type:"codemirror"})),e=>{(e.target.closest(".cm-content")||e.target.closest(".cm-line"))&&t("mouse-click")}),s=(i&&(i.addEventListener("click",e,{passive:!0}),this.minimapEventManager.set("cursor-click",{element:i,handler:e,type:"click"})),e=>{["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Home","End","PageUp","PageDown","Tab"].includes(e.key)&&setTimeout(()=>t("keyboard-"+e.key),10)}),e=(i&&(i.addEventListener("keyup",s,{passive:!0}),this.minimapEventManager.set("cursor-keyboard",{element:i,handler:s,type:"keyup"})),()=>{t("selection-change")});document.addEventListener("selectionchange",e,{passive:!0}),this.minimapEventManager.set("cursor-selection",{element:document,handler:e,type:"selectionchange"}),this.minimapEventManager.set("cursor-main",{element:null,handler:n,type:"workspace"}),this.debugLog("光标位置监听器设置完成，共注册了6种事件类型")}}getCurrentHeading(){if(!this.currentMarkdownView||!this.currentMarkdownView.editor||!this.minimapHeadings)return this.debugLog("getCurrentHeading: 缺少必要的组件"),null;var e=this.currentMarkdownView.editor,i=e.getCursor();let n=i.line+1;if(this.debugLog(`光标位置: 行 ${n} (编辑器行号: ${i.line}), 列 `+i.ch),this.debugLog("总行数: "+e.lineCount()),this.debugLog("标题数量: "+this.minimapHeadings.length),0===this.minimapHeadings.length)return this.debugLog("没有找到任何标题"),null;var s=[];for(let t=0;t<this.minimapHeadings.length;t++){var a=this.minimapHeadings[t];let i=e.lineCount();for(let e=t+1;e<this.minimapHeadings.length;e++){var r=this.minimapHeadings[e];i=r.line-1;break}s.push({...a,startLine:a.line,endLine:i}),this.debugLog(`标题范围计算: "${a.text}" (H${a.level}) -> 行${a.line}-`+i)}this.debugLog("标题范围详情:"),s.forEach((e,i)=>{this.debugLog(`  ${i+1}. "${e.text}" (H${e.level}): 行${e.startLine}-`+e.endLine)});let t=null;var o=[];for(let e=0;e<s.length;e++){var h=s[e];n>=h.startLine&&n<=h.endLine&&(o.push({heading:h,index:e}),this.debugLog(`候选匹配: "${h.text}" (H${h.level}) 行${h.startLine}-`+h.endLine))}if(0<o.length&&(o.sort((e,i)=>i.heading.level-e.heading.level),t=o[0].heading,o[0].index,this.debugLog(`✓ 最终匹配（最深层级）: "${t.text}" (H${t.level}) 行${t.startLine}-`+t.endLine),1<o.length)){this.debugLog("  其他候选项被排除:");for(let e=1;e<o.length;e++){var l=o[e].heading;this.debugLog(`    "${l.text}" (H${l.level}) 行${l.startLine}-`+l.endLine)}}return t||(this.debugLog("✗ 光标不在任何标题范围内"),s.forEach((e,i)=>{var t=n<e.startLine?"在标题之前":n>e.endLine?"在标题之后":"在标题范围内";this.debugLog(`  光标行${n} vs "${e.text}"(${e.startLine}-${e.endLine}): `+t)})),t}updateCurrentHeadingHighlight(){var e,i,t,n;this.minimap?(n=this.minimap.querySelector(".minimap-headings"))?(e=n.querySelectorAll(".heading-block"),this.debugLog(`移除现有高亮，共找到 ${e.length} 个标题块`),e.forEach((e,i)=>{var t=e.classList.contains("current-heading");e.classList.remove("current-heading"),t&&this.debugLog(`  移除第${i+1}个块的高亮 (data-line: ${e.dataset.line})`)}),(i=this.getCurrentHeading())?(t=i.line.toString(),(n=n.querySelector(`[data-line="${t}"]`))?(n.classList.add("current-heading"),this.debugLog(`✓ 成功高亮标题: "${i.text}" (行号: ${i.line})`),this.debugLog(`  对应的DOM块: data-line="${n.dataset.line}", data-index="${n.dataset.index}"`)):(this.debugLog("✗ 未找到对应的标题块，目标行号: "+i.line),this.debugLog("  现有的标题块:"),e.forEach((e,i)=>{this.debugLog(`    第${i+1}个块: data-line="${e.dataset.line}", title="${e.title}"`)}))):this.debugLog("updateCurrentHeadingHighlight: 未找到当前标题，不进行高亮")):this.debugLog("updateCurrentHeadingHighlight: 标题容器不存在"):this.debugLog("updateCurrentHeadingHighlight: 迷你地图不存在")}updateMinimapPosition(){var e,i,t,n;this.minimap&&this.currentMarkdownView&&(i=(e=this.currentMarkdownView.containerEl).querySelector(".cm-scroller"))&&(e=e.getBoundingClientRect(),i=i.getBoundingClientRect(),t=Math.min(i.height-20,.7*window.innerHeight),n="left"===this.settings.minimapPosition?"left: 10px;":"right: 10px;",this.minimap.style.left="",this.minimap.style.right="",this.minimap.style.cssText+=`
            top: ${i.top-e.top+10}px;
            ${n}
            height: ${t}px;
        `)}autoAdjustCursorOnOpen(){if(this.settings.autoAdjustCursorOnOpen){var e=this.app.workspace.getActiveViewOfType(MarkdownView);if(e&&e.editor){let n=e.editor;e=n.lineCount();let s=Math.max(e-1,0),a=n.getLine(s)||"";requestAnimationFrame(()=>{try{0<a.length&&n.replaceRange("\n",{line:s,ch:a.length})}catch(e){}try{var e,i=n.lineCount()-1,t=n.cm;t&&t.dispatch&&t.state&&t.state.doc?(e=t.state.doc.line(1+i),t.dispatch({selection:{anchor:e.from},scrollIntoView:!1})):n.setCursor({line:Math.max(i,0),ch:0})}catch(e){}})}}}hideMinimap(){this.minimap&&(this.minimap.style.display="none"),this.currentMarkdownView=null}showMinimap(){this.minimap&&(this.minimap.style.display="block")}toggleMinimapCollapse(){var e,i,t;this.minimap&&this.settings.minimapCollapsible&&(this.minimapExpanded=!this.minimapExpanded,this.settings.minimapHandleWidth,e="left"===this.settings.minimapPosition,i=this.settings.minimapWidth,e?(t=this.minimapExpanded?0:-i,this.minimap.style.transform=`translateX(${t}px)`):(t=this.minimapExpanded?0:i,this.minimap.style.transform=`translateX(${t}px)`),this.minimapExpanded?this.minimap.classList.remove("collapsed"):this.minimap.classList.add("collapsed"),(i=this.minimap.querySelector(".minimap-handle"))&&(t=i.querySelector("svg path"))&&(e?t.setAttribute("d",this.minimapExpanded?"M5 1L1 6L5 11":"M1 1L5 6L1 11"):t.setAttribute("d",this.minimapExpanded?"M1 1L5 6L1 11":"M5 1L1 6L5 11")),this.debugLog("迷你地图"+(this.minimapExpanded?"展开":"折叠")))}clearMinimapEventListeners(){this.debugLog("开始清理迷你地图事件监听器"),this.tooltipTimer&&(clearTimeout(this.tooltipTimer),this.tooltipTimer=null),this.tooltipHideTimer&&(clearTimeout(this.tooltipHideTimer),this.tooltipHideTimer=null),this.hideTooltip();for(var[e,i]of this.minimapEventManager){var{element:i,handler:t,type:n}=i;this.debugLog(`清理事件: ${e} (类型: ${n})`),e.startsWith("cursor-")?"cursor-cm"===e&&"codemirror"===n&&i&&i.off?i.off("cursorActivity",t):"cursor-click"===e&&"click"===n&&i?i.removeEventListener("click",t):"cursor-keyboard"===e&&"keyup"===n&&i?i.removeEventListener("keyup",t):"cursor-selection"===e&&"selectionchange"===n&&i?i.removeEventListener("selectionchange",t):e:i&&t&&("scroll"===e?i.removeEventListener("scroll",t):"click"===e?i.removeEventListener("click",t):"drag"===e?i.removeEventListener("mousedown",t):"resize"===e?i.removeEventListener("resize",t):e)}this.minimapEventManager.clear(),this.debugLog("迷你地图事件监听器清理完成")}showTooltip(t,n){if(this.tooltipHideTimer&&(clearTimeout(this.tooltipHideTimer),this.tooltipHideTimer=null),this.tooltip&&this.tooltip.textContent===t)this.tooltip.classList.add("show");else{this.hideTooltip(),this.tooltip=document.createElement("div"),this.tooltip.className="minimap-tooltip",this.tooltip.textContent=t,document.body.appendChild(this.tooltip);t=n.getBoundingClientRect(),n=this.tooltip.getBoundingClientRect();let e=t.right+8,i=t.top+(t.height-n.height)/2;e+n.width>window.innerWidth-10&&(e=t.left-n.width-8),i<10?i=10:i+n.height>window.innerHeight-10&&(i=window.innerHeight-n.height-10),this.tooltip.style.left=e+"px",this.tooltip.style.top=i+"px",requestAnimationFrame(()=>{this.tooltip&&this.tooltip.classList.add("show")})}}hideTooltip(){this.tooltip&&(this.tooltip.remove(),this.tooltip=null)}showTooltipWithDelay(e,i,t=150){this.tooltipTimer&&(clearTimeout(this.tooltipTimer),this.tooltipTimer=null),this.tooltipTimer=setTimeout(()=>{this.showTooltip(e,i),this.tooltipTimer=null},t)}hideTooltipWithDelay(e=100){this.tooltipTimer&&(clearTimeout(this.tooltipTimer),this.tooltipTimer=null),this.tooltipHideTimer&&(clearTimeout(this.tooltipHideTimer),this.tooltipHideTimer=null),this.tooltipHideTimer=setTimeout(()=>{this.hideTooltip(),this.tooltipHideTimer=null},e)}scrollToLineCenter(i,t){try{if(i&&"number"==typeof t&&!(t<0)){let e={from:{line:t,ch:0},to:{line:t,ch:0}};i&&"function"==typeof i.scrollIntoView?("function"==typeof i.setCursor&&i.setCursor(t,0),requestAnimationFrame(()=>{try{i.scrollIntoView(e,!0)}catch(e){this.safeScrollToLine(i,t)}})):this.safeScrollToLine(i,t)}}catch(e){try{i&&"function"==typeof i.setCursor&&i.setCursor(t,0)}catch(e){}}}safeScrollToLine(t,n){try{var e,i,s,a,r,o,h,l,g;!t||"number"!=typeof n||n<0||(t&&"function"==typeof t.setCursor?(t.setCursor(n,0),setTimeout(()=>{try{var e,i=t.getCursor();i&&i.line===n&&(e=this.app.workspace.getActiveViewOfType(MarkdownView))&&e.editor===t&&this.centerLineInEditor(t,n)}catch(e){}},50)):(e=this.app.workspace.getActiveViewOfType(MarkdownView))&&e.editor&&(i=e.containerEl.querySelector(".cm-editor"))&&(s=i.querySelector(".cm-scroller"),a=i.querySelector(".cm-content"),s)&&a&&(r=a.querySelectorAll(".cm-line"))&&n<r.length&&(o=r[n].getBoundingClientRect(),h=s.getBoundingClientRect(),l=s.scrollTop,g=o.top-h.top+l-h.height/2,s.scrollTo({top:Math.max(0,g),behavior:"smooth"})))}catch(e){try{t&&"function"==typeof t.setCursor&&t.setCursor(n,0)}catch(e){}}}centerLineInEditor(e,i){try{var t,n,s,a,r,o,h,l,g=this.app.workspace.getActiveViewOfType(MarkdownView);g&&g.editor&&g.editor===e&&(t=g.containerEl.querySelector(".cm-editor"))&&(n=t.querySelector(".cm-scroller"),s=t.querySelector(".cm-content"),n)&&s&&(!(a=s.querySelectorAll(".cm-line"))||i>=a.length||(r=a[i])&&(o=r.getBoundingClientRect(),h=n.getBoundingClientRect(),l=n.scrollTop+(o.top-h.top)-h.height/2,n.scrollTo({top:Math.max(0,l),behavior:"smooth"})))}catch(e){}}async loadSettings(){this.settings=Object.assign({},DEFAULT_SETTINGS,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}}class TitleManagerSettingTab extends PluginSettingTab{constructor(e,i){super(e,i),this.plugin=i}display(){var e=this.containerEl;e.empty(),e.addClass("title-manager-settings"),e.createEl("h2",{text:"Title Manager 设置（具体教程详见「专属插件市场」插件说明文档）"}),new Setting(e).setName("启用标题同步").setDesc("开启后，文档的第一个标题与文件名将自动保持同步").addToggle(e=>e.setValue(this.plugin.settings.syncEnabled).onChange(async e=>{this.plugin.settings.syncEnabled=e,await this.plugin.saveSettings()})),new Setting(e).setName("同步作用路径").setDesc("设置标题同步功能的作用路径，支持多个路径（换行添加多个路径）。仅在这些路径下的文档会启用同步功能").addTextArea(e=>e.setPlaceholder("Documents/I.P.A.R.A\nDocuments/Projects\nNotes").setValue(this.plugin.settings.syncPath).onChange(async e=>{this.plugin.settings.syncPath=e.trim(),await this.plugin.saveSettings()})),new Setting(e).setName("标题到文件名延迟 (毫秒)").setDesc("设置修改标题后同步到文件名的延迟时间，较短的延迟可以更快响应").addText(e=>e.setPlaceholder("300").setValue(this.plugin.settings.headingToFilenameDebounce.toString()).onChange(async e=>{e=parseInt(e);!isNaN(e)&&50<=e&&(this.plugin.settings.headingToFilenameDebounce=e,this.plugin.settings.renameDebounceTimeout=e,await this.plugin.saveSettings())})),new Setting(e).setName("文件名到标题延迟 (毫秒)").setDesc("设置重命名文件后同步到标题的延迟时间，通常可以设置得很短").addText(e=>e.setPlaceholder("100").setValue(this.plugin.settings.filenameToHeadingDebounce.toString()).onChange(async e=>{e=parseInt(e);!isNaN(e)&&50<=e&&(this.plugin.settings.filenameToHeadingDebounce=e,await this.plugin.saveSettings())})),new Setting(e).setName("打开文档时自动避开首行光标").setDesc("打开文档时自动将光标移至文档末尾，避免光标自动放在首行标题或其他格式内容时影响markdown格式或代码渲染").addToggle(e=>e.setValue(this.plugin.settings.autoAdjustCursorOnOpen).onChange(async e=>{this.plugin.settings.autoAdjustCursorOnOpen=e,await this.plugin.saveSettings()})),e.createEl("h3",{text:"大纲迷你地图"}),new Setting(e).setName("启用大纲迷你地图").setDesc("在编辑器右侧显示文档标题结构的可视化迷你地图").addToggle(e=>e.setValue(this.plugin.settings.minimapEnabled).onChange(async e=>{this.plugin.settings.minimapEnabled=e,await this.plugin.saveSettings(),e?this.plugin.initMinimap():this.plugin.destroyMinimap()})),new Setting(e).setName("迷你地图宽度").setDesc("设置迷你地图的宽度（像素值：50-150）").addText(e=>e.setPlaceholder("80").setValue(this.plugin.settings.minimapWidth.toString()).onChange(async e=>{var i,e=parseInt(e);!isNaN(e)&&50<=e&&e<=150&&(this.plugin.settings.minimapWidth=e,await this.plugin.saveSettings(),this.plugin.minimap)&&(this.plugin.minimap.style.width=e+"px",this.plugin.settings.minimapCollapsible)&&!this.plugin.minimapExpanded&&(i=this.plugin.settings.minimapHandleWidth,this.plugin.minimap.style.right=`-${e-i}px`)})),new Setting(e).setName("迷你地图透明度").setDesc("设置迷你地图的透明度（透明度：0.1-1.0）").addText(e=>e.setPlaceholder("0.8").setValue(this.plugin.settings.minimapOpacity.toString()).onChange(async e=>{e=parseFloat(e);!isNaN(e)&&.1<=e&&e<=1&&(this.plugin.settings.minimapOpacity=e,await this.plugin.saveSettings(),this.plugin.minimap)&&(this.plugin.minimap.style.opacity=e.toString())})),new Setting(e).setName("迷你地图位置").setDesc("选择迷你地图显示在编辑器的左侧还是右侧").addDropdown(e=>e.addOption("right","右侧").addOption("left","左侧").setValue(this.plugin.settings.minimapPosition).onChange(async e=>{this.plugin.settings.minimapPosition=e,await this.plugin.saveSettings(),this.plugin.settings.minimapEnabled&&this.plugin.minimap&&(this.plugin.destroyMinimap(),this.plugin.initMinimap())})),new Setting(e).setName("迷你地图主题").setDesc("选择迷你地图的颜色主题").addDropdown(e=>e.addOption("classic-main","跟随系统").addOption("classic-blue","经典蓝色").addOption("warm-orange","温暖橙色").addOption("nature-green","自然绿色").addOption("elegant-purple","优雅紫色").addOption("vibrant-red","活力红色").addOption("fresh-cyan","清新青色").addOption("minimal-gray","简约灰色").setValue(this.plugin.settings.minimapTheme).onChange(async e=>{this.plugin.settings.minimapTheme=e,COLOR_THEMES[e]&&(this.plugin.settings.minimapColors=COLOR_THEMES[e]),await this.plugin.saveSettings(),this.plugin.settings.minimapEnabled&&this.plugin.updateMinimap()})),new Setting(e).setName("启用折叠功能").setDesc("在迷你地图左侧添加可点击的把手，支持抽拉式隐藏/显示").addToggle(e=>e.setValue(this.plugin.settings.minimapCollapsible).onChange(async e=>{this.plugin.settings.minimapCollapsible=e,await this.plugin.saveSettings(),this.plugin.settings.minimapEnabled&&(this.plugin.destroyMinimap(),this.plugin.initMinimap())})),new Setting(e).setName("默认展开状态（仅在启用折叠功能时有效）").setDesc("设置打开文档时迷你地图的默认状态(重启后生效）").addToggle(e=>e.setValue(this.plugin.settings.minimapDefaultExpanded).setDisabled(!this.plugin.settings.minimapCollapsible).onChange(async e=>{this.plugin.settings.minimapDefaultExpanded=e,await this.plugin.saveSettings()})),new Setting(e).setName("迷你地图块高度").setDesc("设置迷你地图中每个标题块的高度（像素值：4-12）").addText(e=>e.setPlaceholder("6").setValue(this.plugin.settings.minimapBlockHeight.toString()).onChange(async e=>{e=parseInt(e);!isNaN(e)&&4<=e&&e<=12&&(this.plugin.settings.minimapBlockHeight=e,await this.plugin.saveSettings(),this.plugin.settings.minimapEnabled)&&this.plugin.updateMinimap()})),new Setting(e).setName("迷你地图块字体大小").setDesc("设置迷你地图中每个标题块的字体大小（像素值：4-12）").addText(e=>e.setPlaceholder("6").setValue(this.plugin.settings.minimapBlockFontSize.toString()).onChange(async e=>{e=parseInt(e);!isNaN(e)&&4<=e&&e<=12&&(this.plugin.settings.minimapBlockFontSize=e,await this.plugin.saveSettings(),this.plugin.settings.minimapEnabled)&&this.plugin.updateMinimap()}))}}module.exports=TitleManagerPlugin;