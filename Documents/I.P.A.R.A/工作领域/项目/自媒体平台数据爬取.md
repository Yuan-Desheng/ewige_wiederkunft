---
createTime: 2026-01-05 13:07
description:
multiFile:
multiMedia:
ç¬”è®°ID: 20260105130700
ç¬”è®°ç±»å‹: é¡¹ç›®ç¬”è®°
é˜è¿°æ—¥æœŸ:
å¡ç‰‡ç›’ç¬”è®°ä¸»é¢˜:
  - "[[Documents/I.P.A.R.A/å·¥ä½œé¢†åŸŸ/å½’æ¡£/å¡ç‰‡ç›’ç¬”è®°ä¸»é¢˜ç´¢å¼•å¡/æµ·åª’ä¼ æ’­åˆ†æç³»ç»Ÿ.canvas|æµ·åª’ä¼ æ’­åˆ†æç³»ç»Ÿ]]"
tags:
  - scrapy
  - tikhub
---

##  è‡ªåª’ä½“å¹³å°æ•°æ®çˆ¬å–
```meta-bind-embed
[[ç¬”è®°æŠ¬å¤´æ¨¡å—]]
```
<progress value="10" max="100" style="width: 100%;"></progress>
## å¾…åŠäº‹é¡¹
- [x] å¯¹æ¯”'# è·å–ç”¨æˆ·å¸–å­åˆ—è¡¨V2/Get user posts list V2'å’Œ'# è·å–ç”¨æˆ·å¸–å­/Get user posts' [ğŸ”—Dida](obsidian://dida-task?didaId=695b5140e4b00d63de86f61d) 
- [ ] è§„åˆ’å°†çˆ¬è™«ç¨‹åºé›†æˆåˆ°åå°ç³»ç»Ÿå½“ä¸­ï¼Œé€šè¿‡å°†çˆ¬è™«è„šæœ¬ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œé€šè¿‡åå°ç³»ç»Ÿæ§åˆ¶çˆ¬è™«è„šæœ¬ [ğŸ”—Dida](obsidian://dida-task?didaId=695b9f35e4b04079ec797494) 
- [x] æœåŠ¡å™¨ç¯å¢ƒå‡†å¤‡ (Linux) [ğŸ”—Dida](obsidian://dida-task?didaId=695ca7fde4b072c2c7a9ef2c) 
- [ ] tikhub_tiktok_scraperæ”¹é€ æ•°æ®åº“ï¼Œä¸åŒå¹³å°çš„ç”¨æˆ·ä¿¡æ¯å¯ä»¥ç”¨åŒä¸€å¼ æ•°æ®è¡¨è¿›è¡Œä¿å­˜ï¼ˆå¹¶ç»“åˆç°æœ‰åå°ç³»ç»Ÿä¸­çš„äººç‰©ç®¡ç†è¡¨ï¼šyuqing_personã€äººç‰©è´¦å·ç®¡ç†è¡¨yuqing_leader_infoä¸­éœ€è¦çš„å­—æ®µè¿›è¡Œä¿®æ”¹ï¼‰ï¼Œä»ä¸åŒå¹³å°ç”¨æˆ·è·å–åˆ°çš„å¸–å­å¯ä»¥ç”¨åŒä¸€å¼ æ•°æ®è¡¨è¿›è¡Œä¿å­˜ï¼ˆå¹¶ç»“åˆç°æœ‰åå°ç³»ç»Ÿä¸­çš„yuqing_post_infoï¼‰
- [ ] tikhub_tiktok_scraperé›†æˆScrapydå®ç°é€šè¿‡æ¥å£è°ƒç”¨çˆ¬è™«é¡¹ç›® [ğŸ”—Dida](obsidian://dida-task?didaId=695ca817e4b031f009ca54f7) 

# tikhub_tiktok_scraper
## åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```html
python -m venv venv
```
## æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
- Windows:
```html
venv\\Scripts\\activate
```
- macOS/Linux:
```html
source venv/bin/activate
```
- ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆæœ‰requirements.txtæ–‡ä»¶çš„ç›®å½•ï¼‰
```html
pip install -r requirements.txt
```
- è¿è¡ŒÂ `init_db.py`æ¥åˆ›å»ºè¡¨
```html
python init_db.py
```
## è¿è¡Œçˆ¬è™«
```html
cd tikhub_scraper
```
- è·å–ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯
```bash
scrapy crawl tiktok_profile
```
- è·å–ç”¨æˆ·çš„ä½œå“åˆ—è¡¨
```bash
scrapy crawl tiktok_posts
    ```
- è·å–å•ä¸ªä½œå“æ•°æ®
```bash
scrapy crawl tiktok_video
```
- è·å–xå¹³å°ç”¨æˆ·æ•°æ®
```bash
scrapy crawl x_user_post
```
- instagramå¹³å°æ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ·æ•°æ®
```bash
scrapy crawl instagram_profile
```
- è·å–ç”¨æˆ·å¸–å­åˆ—è¡¨V2
```bash
scrapy crawl instagram_user_posts_v2
```



### å·²åºŸå¼ƒå‘½ä»¤
- æ ¹æ®ç”¨æˆ·åè·å–Taggedä½œå“åˆ—è¡¨æ•°æ® 
```bash
scrapy crawl instagram_tagged_posts
```
- æ ¹æ®ç”¨æˆ·IDè·å–ç”¨æˆ·å‘å¸ƒçš„å¸–å­
```bash
scrapy crawl instagram_user_posts_by_user_id
```


## ä»£ç ç”Ÿæˆæç¤ºè¯
- ä»£ç ç”Ÿæˆæç¤ºè¯1
```bash
    ç°åœ¨Scraperé¡¹ç›®tikhub_tiktok_scraperçˆ¬å–ç”¨æˆ·ä¸ªäººä¿¡æ¯æ•°æ®æ¥å£/api/v1/tiktok/web/fetch_user_profileçš„ä»£ç æ˜¯
    tikhub_tiktok_scraper/init_db.py
    # tikhub_tiktok_scraper/init_db.py
    import os
    import sys
    import logging
    from pathlib import Path
    from dotenv import load_dotenv
    
    # æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°ç³»ç»Ÿè·¯å¾„
    project_root = Path(__file__).parent
    sys.path.append(str(project_root))
    
    # é…ç½®æ—¥å¿—
    logging.basicConfig(level=logging.INFO)
    logger = logging.getLogger(__name__)
    
    def init_database():
        """åˆå§‹åŒ–æ•°æ®åº“è¡¨"""
        load_dotenv()
    
        database_url = os.getenv('DATABASE_URL')
        if not database_url:
            logger.error("æœªæ‰¾åˆ°DATABASE_URLç¯å¢ƒå˜é‡")
            return False
    
        try:
            from sqlalchemy import create_engine
            # ä½¿ç”¨æ­£ç¡®çš„å¯¼å…¥è·¯å¾„
            from tikhub_scraper.tikhub_scraper.items import Base
    
            engine = create_engine(database_url)
            Base.metadata.create_all(engine)
            logger.info("æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ")
            return True
        except ImportError as e:
            logger.error(f"å¯¼å…¥é”™è¯¯: {e}")
            logger.info("å½“å‰ç³»ç»Ÿè·¯å¾„:")
            for p in sys.path:
                logger.info(p)
            return False
        except Exception as e:
            logger.error(f"æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥: {e}")
            return False
    
    if __name__ == "__main__":
        logger.info(f"å½“å‰å·¥ä½œç›®å½•: {os.getcwd()}")
        logger.info(f"é¡¹ç›®æ ¹ç›®å½•: {project_root}")
        logger.info(f"ç³»ç»Ÿè·¯å¾„: {sys.path}")
        if init_database():
            logger.info("æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ")
        else:
            logger.error("æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥")
            sys.exit(1)
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/items.py
    # items.py
    import scrapy
    from sqlalchemy import Column, Integer, String, Text, DateTime, Boolean, BigInteger
    from sqlalchemy.ext.declarative import declarative_base
    from datetime import datetime
    
    Base = declarative_base()
    
    class TikTokUserItem(scrapy.Item):
        # ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
        user_id = scrapy.Field()
        short_id = scrapy.Field()
        unique_id = scrapy.Field()
        nickname = scrapy.Field()
        signature = scrapy.Field()
        avatar_larger = scrapy.Field()
        avatar_medium = scrapy.Field()
        avatar_thumb = scrapy.Field()
        create_time = scrapy.Field()
        verified = scrapy.Field()
        sec_uid = scrapy.Field()
        ftc = scrapy.Field()
        relation = scrapy.Field()
        open_favorite = scrapy.Field()
        comment_setting = scrapy.Field()
        commerce_user = scrapy.Field()
        duet_setting = scrapy.Field()
        stitch_setting = scrapy.Field()
        private_account = scrapy.Field()
        secret_account = scrapy.Field()
        is_ad_virtual = scrapy.Field()
        room_id = scrapy.Field()
        unique_id_modify_time = scrapy.Field()
        tt_seller = scrapy.Field()
        download_setting = scrapy.Field()
        show_music_tab = scrapy.Field()
        show_question_tab = scrapy.Field()
        show_playlist_tab = scrapy.Field()
        following_visibility = scrapy.Field()
        recommend_reason = scrapy.Field()
        now_invitation_card_url = scrapy.Field()
        nick_name_modify_time = scrapy.Field()
        is_embed_banned = scrapy.Field()
        can_exp_playlist = scrapy.Field()
        profile_embed_permission = scrapy.Field()
        language = scrapy.Field()
        suggest_account_bind = scrapy.Field()
        is_organization = scrapy.Field()
        user_story_status = scrapy.Field()
    
        # ç»Ÿè®¡æ•°æ®
        stats_follower_count = scrapy.Field()
        stats_following_count = scrapy.Field()
        stats_heart = scrapy.Field()
        stats_heart_count = scrapy.Field()
        stats_video_count = scrapy.Field()
        stats_digg_count = scrapy.Field()
        stats_friend_count = scrapy.Field()
    
        # ç»Ÿè®¡æ•°æ®V2
        stats_v2_follower_count = scrapy.Field()
        stats_v2_following_count = scrapy.Field()
        stats_v2_heart = scrapy.Field()
        stats_v2_heart_count = scrapy.Field()
        stats_v2_video_count = scrapy.Field()
        stats_v2_digg_count = scrapy.Field()
        stats_v2_friend_count = scrapy.Field()
    
        # åˆ†äº«å…ƒæ•°æ®
        share_title = scrapy.Field()
        share_desc = scrapy.Field()
    
        # çŠ¶æ€ä¿¡æ¯
        status_code = scrapy.Field()
        status_msg = scrapy.Field()
        need_fix = scrapy.Field()
    
        # æ—¶é—´æˆ³
        crawl_time = scrapy.Field()
    
    class TikTokUser(Base):
        __tablename__ = 'tiktok_users'
    
        id = Column(Integer, primary_key=True, autoincrement=True)
    
        # ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
        user_id = Column(String(50), nullable=False, unique=True)
        short_id = Column(String(50))
        unique_id = Column(String(100), nullable=False, index=True)
        nickname = Column(String(200))
        signature = Column(Text)
        avatar_larger = Column(Text)
        avatar_medium = Column(Text)
        avatar_thumb = Column(Text)
        create_time = Column(BigInteger, index=True)
        verified = Column(Boolean, default=False, index=True)
        sec_uid = Column(String(200), index=True)
        ftc = Column(Boolean, default=False)
        relation = Column(Integer, default=0)
        open_favorite = Column(Boolean, default=False)
        comment_setting = Column(Integer, default=0)
        commerce_user = Column(Boolean, default=False)
        duet_setting = Column(Integer, default=0)
        stitch_setting = Column(Integer, default=0)
        private_account = Column(Boolean, default=False)
        secret_account = Column(Boolean, default=False)
        is_ad_virtual = Column(Boolean, default=False)
        room_id = Column(String(100))
        unique_id_modify_time = Column(BigInteger, default=0)
        tt_seller = Column(Boolean, default=False)
        download_setting = Column(Integer, default=0)
        show_music_tab = Column(Boolean, default=False)
        show_question_tab = Column(Boolean, default=False)
        show_playlist_tab = Column(Boolean, default=False)
        following_visibility = Column(Integer, default=1)
        recommend_reason = Column(Text)
        now_invitation_card_url = Column(Text)
        nick_name_modify_time = Column(BigInteger, default=0)
        is_embed_banned = Column(Boolean, default=False)
        can_exp_playlist = Column(Boolean, default=False)
        profile_embed_permission = Column(Integer, default=1)
        language = Column(String(10), index=True)
        suggest_account_bind = Column(Boolean, default=False)
        is_organization = Column(Integer, default=0)
        user_story_status = Column(Integer, default=0)
    
        # ç»Ÿè®¡æ•°æ®
        stats_follower_count = Column(BigInteger, default=0)
        stats_following_count = Column(Integer, default=0)
        stats_heart = Column(BigInteger, default=0)
        stats_heart_count = Column(BigInteger, default=0)
        stats_video_count = Column(Integer, default=0)
        stats_digg_count = Column(Integer, default=0)
        stats_friend_count = Column(Integer, default=0)
    
        # ç»Ÿè®¡æ•°æ®V2
        stats_v2_follower_count = Column(BigInteger, default=0)
        stats_v2_following_count = Column(Integer, default=0)
        stats_v2_heart = Column(BigInteger, default=0)
        stats_v2_heart_count = Column(BigInteger, default=0)
        stats_v2_video_count = Column(Integer, default=0)
        stats_v2_digg_count = Column(Integer, default=0)
        stats_v2_friend_count = Column(Integer, default=0)
    
        # åˆ†äº«å…ƒæ•°æ®
        share_title = Column(Text)
        share_desc = Column(Text)
    
        # çŠ¶æ€ä¿¡æ¯
        status_code = Column(Integer, default=0)
        status_msg = Column(String(255))
        need_fix = Column(Boolean, default=False)
    
        # æ—¶é—´æˆ³
        crawl_time = Column(DateTime, default=datetime.utcnow, index=True)
        created_at = Column(DateTime, default=datetime.utcnow)
        updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/pipelines.py
    # tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/pipelines.py
    import logging
    from sqlalchemy.orm import sessionmaker
    from tikhub_scraper.items import TikTokUserItem, TikTokUser
    import os
    from dotenv import load_dotenv
    
    class TikTokUserPipeline:
        def __init__(self):
            self.engine = None
            self.Session = None
            self.logger = logging.getLogger(__name__)
    
        @classmethod
        def from_crawler(cls, crawler):
            pipeline = cls()
            pipeline.crawler = crawler
            return pipeline
    
        def open_spider(self, spider):
            """çˆ¬è™«å¼€å¯æ—¶è¿æ¥æ•°æ®åº“"""
            load_dotenv()
    
            database_url = os.getenv('DATABASE_URL')
            if not database_url:
                self.logger.error("æœªæ‰¾åˆ°DATABASE_URLç¯å¢ƒå˜é‡")
                return
    
            try:
                from sqlalchemy import create_engine
                self.engine = create_engine(database_url)
                self.Session = sessionmaker(bind=self.engine)
                self.logger.info("æ•°æ®åº“è¿æ¥æˆåŠŸ")
            except Exception as e:
                self.logger.error(f"æ•°æ®åº“è¿æ¥å¤±è´¥: {e}")
    
        def close_spider(self, spider):
            """çˆ¬è™«å…³é—­æ—¶æ–­å¼€æ•°æ®åº“è¿æ¥"""
            if self.engine:
                self.engine.dispose()
                self.logger.info("æ•°æ®åº“è¿æ¥å·²å…³é—­")
    
        def process_item(self, item, spider):
            """å¤„ç†çˆ¬å–çš„æ•°æ®é¡¹"""
            if not isinstance(item, TikTokUserItem):
                return item
    
            if not self.Session:
                self.logger.error("æ•°æ®åº“ä¼šè¯æœªåˆå§‹åŒ–")
                return item
    
            session = self.Session()
            try:
                # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨ï¼ˆåŸºäºuser_idï¼‰
                existing_user = session.query(TikTokUser).filter_by(
                    user_id=item['user_id']
                ).first()
    
                if existing_user:
                    # æ›´æ–°ç°æœ‰ç”¨æˆ· - æ›´æ–°æ‰€æœ‰å­—æ®µ
                    for field in item.fields:
                        if hasattr(existing_user, field) and field in item:
                            setattr(existing_user, field, item[field])
    
                    self.logger.info(f"æ›´æ–°ç”¨æˆ·æ•°æ®: {item['unique_id']}")
                else:
                    # åˆ›å»ºæ–°ç”¨æˆ·è®°å½•
                    user_data = {}
                    for field in item.fields:
                        if field in item:
                            user_data[field] = item[field]
    
                    user = TikTokUser(**user_data)
                    session.add(user)
                    self.logger.info(f"æ–°å¢ç”¨æˆ·æ•°æ®: {item['unique_id']}")
    
                session.commit()
    
            except Exception as e:
                session.rollback()
                self.logger.error(f"ä¿å­˜ç”¨æˆ·æ•°æ®å¤±è´¥: {e}")
            finally:
                session.close()
    
            return item
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/spiders/tiktok_profile_spider.py
    # tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/spiders/tiktok_profile_spider.py
    import scrapy
    import json
    from urllib.parse import urlencode
    from tikhub_scraper.items import TikTokUserItem
    from datetime import datetime
    import os
    import logging
    
    class JSONLogger:
        """JSONå“åº”æ—¥å¿—è®°å½•å™¨"""
    
        def __init__(self, spider_name, log_dir="json_logs"):
            self.spider_name = spider_name
            self.log_dir = log_dir
            self.logger = logging.getLogger(__name__)
    
            # åˆ›å»ºæ—¥å¿—ç›®å½•
            if not os.path.exists(self.log_dir):
                os.makedirs(self.log_dir)
                self.logger.info(f"åˆ›å»ºJSONæ—¥å¿—ç›®å½•: {self.log_dir}")
    
        def save_response(self, username, response_data, success=True):
            """ä¿å­˜APIå“åº”åˆ°JSONæ–‡ä»¶"""
            try:
                # ç”Ÿæˆæ–‡ä»¶å
                timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
                status = "success" if success else "error"
                filename = f"{timestamp}_{username}_{status}.json"
                filepath = os.path.join(self.log_dir, filename)
    
                # ä¿å­˜JSONæ–‡ä»¶
                with open(filepath, 'w', encoding='utf-8') as f:
                    json.dump(response_data, f, ensure_ascii=False, indent=2)
    
                self.logger.debug(f"å·²ä¿å­˜JSONå“åº”: {filepath}")
                return filepath
    
            except Exception as e:
                self.logger.error(f"ä¿å­˜JSONå“åº”å¤±è´¥: {e}")
                return None
    
        def save_error_response(self, username, error_info, request_url=None):
            """ä¿å­˜é”™è¯¯ä¿¡æ¯åˆ°JSONæ–‡ä»¶"""
            error_data = {
                "timestamp": datetime.now().isoformat(),
                "username": username,
                "error": str(error_info),
                "request_url": request_url,
                "success": False
            }
    
            return self.save_response(username, error_data, success=False)
    
    class TikTokProfileSpider(scrapy.Spider):
        name = 'tiktok_profile'
        allowed_domains = ['api.tikhub.io']
    
        def __init__(self, *args, **kwargs):
            super().__init__(*args, **kwargs)
            # åˆå§‹åŒ–JSONæ—¥å¿—è®°å½•å™¨
            self.json_logger = JSONLogger(self.name)
    
        # è¦çˆ¬å–çš„ç”¨æˆ·åˆ—è¡¨
        users_to_scrape = [
            {'uniqueId': 'anuwattiktok', 'secUid': ''},
        ]
    
        def start_requests(self):
            """ç”Ÿæˆåˆå§‹è¯·æ±‚"""
            base_url = '<https://api.tikhub.io/api/v1/tiktok/web/fetch_user_profile>'
    
            for user in self.users_to_scrape:
                params = {k: v for k, v in user.items() if v and v != 'null'}
                url = f"{base_url}?{urlencode(params)}"
    
                self.logger.info(f"å‡†å¤‡çˆ¬å–ç”¨æˆ·: {user.get('uniqueId', 'Unknown')}")
    
                yield scrapy.Request(
                    url=url,
                    callback=self.parse,
                    meta={'user_info': user},
                    errback=self.handle_error
                )
    
        def parse(self, response):
            """è§£æAPIå“åº”"""
            user_info = response.meta['user_info']
            username = user_info.get('uniqueId', 'Unknown')
    
            if response.status != 200:
                self.logger.error(f"è¯·æ±‚å¤±è´¥: çŠ¶æ€ç  {response.status}")
                return
    
            try:
                data = json.loads(response.text)
    
                # ä¿å­˜åŸå§‹APIå“åº”åˆ°JSONæ–‡ä»¶
                json_filepath = self.json_logger.save_response(username, data)
                if json_filepath:
                    self.logger.info(f"å·²ä¿å­˜APIå“åº”åˆ°: {json_filepath}")
    
                if data.get('code') == 200 and data.get('data'):
                    api_data = data['data']
                    user_info_data = api_data.get('userInfo', {})
                    user = user_info_data.get('user', {})
                    stats = user_info_data.get('stats', {})
                    stats_v2 = user_info_data.get('statsV2', {})
                    share_meta = api_data.get('shareMeta', {})
    
                    item = TikTokUserItem()
    
                    # æ•°æ®è½¬æ¢å‡½æ•°
                    def safe_int_convert(value, default=0):
                        if value is None:
                            return default
                        try:
                            if isinstance(value, str):
                                value = value.replace(',', '')
                                return int(value) if value.strip() else default
                            elif isinstance(value, (int, float)):
                                return int(value)
                            return default
                        except (ValueError, TypeError):
                            return default
    
                    def safe_bool_convert(value, default=False):
                        if value is None:
                            return default
                        return bool(value)
    
                    # ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
                    item['user_id'] = user.get('id', '')
                    item['short_id'] = user.get('shortId', '')
                    item['unique_id'] = user.get('uniqueId', '') or username
                    item['nickname'] = user.get('nickname', '')
                    item['signature'] = user.get('signature', '')
                    item['avatar_larger'] = user.get('avatarLarger', '')
                    item['avatar_medium'] = user.get('avatarMedium', '')
                    item['avatar_thumb'] = user.get('avatarThumb', '')
                    item['create_time'] = safe_int_convert(user.get('createTime'))
                    item['verified'] = safe_bool_convert(user.get('verified'))
                    item['sec_uid'] = user.get('secUid', '')
                    item['ftc'] = safe_bool_convert(user.get('ftc'))
                    item['relation'] = safe_int_convert(user.get('relation'))
                    item['open_favorite'] = safe_bool_convert(user.get('openFavorite'))
                    item['comment_setting'] = safe_int_convert(user.get('commentSetting'))
    
                    # å•†ä¸šç”¨æˆ·ä¿¡æ¯
                    commerce_info = user.get('commerceUserInfo', {})
                    item['commerce_user'] = safe_bool_convert(commerce_info.get('commerceUser'))
    
                    item['duet_setting'] = safe_int_convert(user.get('duetSetting'))
                    item['stitch_setting'] = safe_int_convert(user.get('stitchSetting'))
                    item['private_account'] = safe_bool_convert(user.get('privateAccount'))
                    item['secret_account'] = safe_bool_convert(user.get('secret'))
                    item['is_ad_virtual'] = safe_bool_convert(user.get('isADVirtual'))
                    item['room_id'] = user.get('roomId', '')
                    item['unique_id_modify_time'] = safe_int_convert(user.get('uniqueIdModifyTime'))
                    item['tt_seller'] = safe_bool_convert(user.get('ttSeller'))
                    item['download_setting'] = safe_int_convert(user.get('downloadSetting'))
    
                    # ä¸ªäººèµ„æ–™æ ‡ç­¾è®¾ç½®
                    profile_tab = user.get('profileTab', {})
                    item['show_music_tab'] = safe_bool_convert(profile_tab.get('showMusicTab'))
                    item['show_question_tab'] = safe_bool_convert(profile_tab.get('showQuestionTab'))
                    item['show_playlist_tab'] = safe_bool_convert(profile_tab.get('showPlayListTab'))
    
                    item['following_visibility'] = safe_int_convert(user.get('followingVisibility'))
                    item['recommend_reason'] = user.get('recommendReason', '')
                    item['now_invitation_card_url'] = user.get('nowInvitationCardUrl', '')
                    item['nick_name_modify_time'] = safe_int_convert(user.get('nickNameModifyTime'))
                    item['is_embed_banned'] = safe_bool_convert(user.get('isEmbedBanned'))
                    item['can_exp_playlist'] = safe_bool_convert(user.get('canExpPlaylist'))
                    item['profile_embed_permission'] = safe_int_convert(user.get('profileEmbedPermission'))
                    item['language'] = user.get('language', '')
                    item['suggest_account_bind'] = safe_bool_convert(user.get('suggestAccountBind'))
                    item['is_organization'] = safe_int_convert(user.get('isOrganization'))
                    item['user_story_status'] = safe_int_convert(user.get('UserStoryStatus'))
    
                    # ç»Ÿè®¡æ•°æ®
                    item['stats_follower_count'] = safe_int_convert(stats.get('followerCount'))
                    item['stats_following_count'] = safe_int_convert(stats.get('followingCount'))
                    item['stats_heart'] = safe_int_convert(stats.get('heart'))
                    item['stats_heart_count'] = safe_int_convert(stats.get('heartCount'))
                    item['stats_video_count'] = safe_int_convert(stats.get('videoCount'))
                    item['stats_digg_count'] = safe_int_convert(stats.get('diggCount'))
                    item['stats_friend_count'] = safe_int_convert(stats.get('friendCount'))
    
                    # ç»Ÿè®¡æ•°æ®V2
                    item['stats_v2_follower_count'] = safe_int_convert(stats_v2.get('followerCount'))
                    item['stats_v2_following_count'] = safe_int_convert(stats_v2.get('followingCount'))
                    item['stats_v2_heart'] = safe_int_convert(stats_v2.get('heart'))
                    item['stats_v2_heart_count'] = safe_int_convert(stats_v2.get('heartCount'))
                    item['stats_v2_video_count'] = safe_int_convert(stats_v2.get('videoCount'))
                    item['stats_v2_digg_count'] = safe_int_convert(stats_v2.get('diggCount'))
                    item['stats_v2_friend_count'] = safe_int_convert(stats_v2.get('friendCount'))
    
                    # åˆ†äº«å…ƒæ•°æ®
                    item['share_title'] = share_meta.get('title', '')
                    item['share_desc'] = share_meta.get('desc', '')
    
                    # çŠ¶æ€ä¿¡æ¯
                    item['status_code'] = safe_int_convert(api_data.get('statusCode'))
                    item['status_msg'] = api_data.get('statusMsg', '')
                    item['need_fix'] = safe_bool_convert(api_data.get('needFix'))
    
                    # æ—¶é—´æˆ³
                    item['crawl_time'] = datetime.utcnow()
    
                    self.logger.info(f"æˆåŠŸçˆ¬å–ç”¨æˆ·: {item['unique_id']} - {item['nickname']}")
                    yield item
    
                else:
                    error_msg = data.get('message', 'Unknown error')
                    self.logger.error(f"APIå“åº”é”™è¯¯: {error_msg} - ç”¨æˆ·: {username}")
    
            except Exception as e:
                self.logger.error(f"è§£æç”¨æˆ·æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯: {e} - ç”¨æˆ·: {username}")
    
        def handle_error(self, failure):
            """å¤„ç†è¯·æ±‚é”™è¯¯"""
            self.logger.error(f"è¯·æ±‚å¤±è´¥: {failure.value}")
    
            # è·å–è¯·æ±‚ä¿¡æ¯
            request = failure.request
            user_info = request.meta.get('user_info', {})
            username = user_info.get('uniqueId', 'Unknown')
    
            self.logger.error(f"å¤±è´¥çš„URL: {request.url}")
    
            # ä¿å­˜é”™è¯¯ä¿¡æ¯åˆ°JSONæ–‡ä»¶
            error_data = {
                "timestamp": datetime.now().isoformat(),
                "username": username,
                "error": str(failure.value),
                "request_url": request.url,
                "request_headers": dict(request.headers)
            }
            self.json_logger.save_response(username, error_data, success=False)
    è¯·å‚è€ƒä»£ç å¸®æˆ‘ç”Ÿæˆ
    # è·å–ç”¨æˆ·çš„ä½œå“åˆ—è¡¨/Get user postsæ¥å£
    conn.request("GET", "/api/v1/tiktok/web/fetch_user_post?secUid=MS4wLjABAAAAv7iSuuXDJGDvJkmH_vz1qkDZYo1apxgzaxdBSeIuPiM&cursor=0&count=20&coverFormat=2&post_item_list_request_type=0", payload, headers)
    é›†æˆåˆ°ä¹‹å‰ä½¿ç”¨scraperå¼€å‘çš„tikhub_tiktok_scraperé¡¹ç›®å½“ä¸­å»ï¼Œ
    ä¿å­˜æ•°æ®çš„æ•°æ®è¡¨ç»“æ„æ˜¯
    CREATE TABLE tiktok_user_posts (
        id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'è‡ªå¢ä¸»é”®ID',
        aweme_id VARCHAR(64) NOT NULL UNIQUE COMMENT 'ä½œå“å”¯ä¸€ID',
        sec_uid VARCHAR(128) NOT NULL COMMENT 'ç”¨æˆ·å®‰å…¨UID',
        `desc` TEXT COMMENT 'ä½œå“æè¿°æ–‡æœ¬',
        create_time DATETIME COMMENT 'ä½œå“åˆ›å»ºæ—¶é—´',
        video_url TEXT COMMENT 'è§†é¢‘æ’­æ”¾åœ°å€',
        cover_url TEXT COMMENT 'è§†é¢‘å°é¢åœ°å€',
        duration INT COMMENT 'è§†é¢‘æ—¶é•¿(ç§’)',
        width INT COMMENT 'è§†é¢‘å®½åº¦(åƒç´ )',
        height INT COMMENT 'è§†é¢‘é«˜åº¦(åƒç´ )',
        ratio VARCHAR(16) COMMENT 'è§†é¢‘æ¯”ä¾‹',
        definition VARCHAR(16) COMMENT 'è§†é¢‘æ¸…æ™°åº¦(å¦‚540p)',
        video_quality VARCHAR(32) COMMENT 'è§†é¢‘è´¨é‡æè¿°',
        video_format VARCHAR(16) COMMENT 'è§†é¢‘æ ¼å¼(å¦‚mp4)',
        codec_type VARCHAR(16) COMMENT 'è§†é¢‘ç¼–è§£ç ç±»å‹',
        music_id VARCHAR(64) COMMENT 'éŸ³ä¹ID',
        music_title VARCHAR(255) COMMENT 'éŸ³ä¹æ ‡é¢˜',
        music_author VARCHAR(255) COMMENT 'éŸ³ä¹ä½œè€…',
        music_play_url TEXT COMMENT 'éŸ³ä¹æ’­æ”¾åœ°å€',
        music_cover_url TEXT COMMENT 'éŸ³ä¹å°é¢åœ°å€',
        music_duration INT COMMENT 'éŸ³ä¹æ—¶é•¿(ç§’)',
        play_count BIGINT DEFAULT 0 COMMENT 'æ’­æ”¾æ¬¡æ•°',
        digg_count BIGINT DEFAULT 0 COMMENT 'ç‚¹èµæ•°',
        comment_count BIGINT DEFAULT 0 COMMENT 'è¯„è®ºæ•°',
        share_count BIGINT DEFAULT 0 COMMENT 'åˆ†äº«æ•°',
        collect_count BIGINT DEFAULT 0 COMMENT 'æ”¶è—æ•°',
        is_ad TINYINT(1) DEFAULT 0 COMMENT 'æ˜¯å¦æ˜¯å¹¿å‘Š(0å¦1æ˜¯)',
        is_original TINYINT(1) DEFAULT 1 COMMENT 'æ˜¯å¦åŸåˆ›(0å¦1æ˜¯)',
        is_reviewing TINYINT(1) DEFAULT 0 COMMENT 'æ˜¯å¦åœ¨å®¡æ ¸ä¸­',
        author_id VARCHAR(64) COMMENT 'ä½œè€…ç”¨æˆ·ID',
        author_sec_uid VARCHAR(128) COMMENT 'ä½œè€…å®‰å…¨UID',
        author_nickname VARCHAR(255) COMMENT 'ä½œè€…æ˜µç§°',
        author_avatar TEXT COMMENT 'ä½œè€…å¤´åƒURL',
        author_signature TEXT COMMENT 'ä½œè€…ä¸ªæ€§ç­¾å',
        author_verified TINYINT(1) DEFAULT 0 COMMENT 'ä½œè€…æ˜¯å¦è®¤è¯',
        author_follower_count BIGINT DEFAULT 0 COMMENT 'ä½œè€…ç²‰ä¸æ•°',
        author_following_count BIGINT DEFAULT 0 COMMENT 'ä½œè€…å…³æ³¨æ•°',
        author_heart_count BIGINT DEFAULT 0 COMMENT 'ä½œè€…è·èµæ•°',
        author_video_count BIGINT DEFAULT 0 COMMENT 'ä½œè€…è§†é¢‘æ•°',
        challenges JSON COMMENT 'æŒ‘æˆ˜è¯é¢˜ä¿¡æ¯(JSONæ ¼å¼)',
        hashtags JSON COMMENT 'æ ‡ç­¾ä¿¡æ¯(JSONæ ¼å¼)',
        mentions JSON COMMENT 'æåŠç”¨æˆ·ä¿¡æ¯(JSONæ ¼å¼)',
        stickers JSON COMMENT 'è´´çº¸ä¿¡æ¯(JSONæ ¼å¼)',
        effect_stickers JSON COMMENT 'ç‰¹æ•ˆè´´çº¸ä¿¡æ¯(JSONæ ¼å¼)',
        text_extra JSON COMMENT 'æ–‡æœ¬é¢å¤–ä¿¡æ¯(JSONæ ¼å¼)',
        video_extra JSON COMMENT 'è§†é¢‘é¢å¤–ä¿¡æ¯(JSONæ ¼å¼)',
        music_extra JSON COMMENT 'éŸ³ä¹é¢å¤–ä¿¡æ¯(JSONæ ¼å¼)',
        stats_extra JSON COMMENT 'ç»Ÿè®¡é¢å¤–ä¿¡æ¯(JSONæ ¼å¼)',
        cla_info JSON COMMENT 'å­—å¹•ä¿¡æ¯(JSONæ ¼å¼)',
        bitrate_info JSON COMMENT 'ç ç‡ä¿¡æ¯(JSONæ ¼å¼)',
        video_bitrate INT COMMENT 'è§†é¢‘ç ç‡',
        audio_bitrate INT COMMENT 'éŸ³é¢‘ç ç‡',
        vq_score FLOAT COMMENT 'è§†é¢‘è´¨é‡è¯„åˆ†',
        volume_info JSON COMMENT 'éŸ³é‡ä¿¡æ¯(JSONæ ¼å¼)',
        raw_data JSON COMMENT 'åŸå§‹APIå“åº”æ•°æ®(JSONæ ¼å¼)',
        crawled_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ•°æ®çˆ¬å–æ—¶é—´',
        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ•°æ®æ›´æ–°æ—¶é—´',
        INDEX idx_aweme_id (aweme_id),
        INDEX idx_sec_uid (sec_uid),
        INDEX idx_create_time (create_time),
        INDEX idx_author_id (author_id),
        INDEX idx_crawled_at (crawled_at)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='TikTokç”¨æˆ·ä½œå“æ•°æ®è¡¨';
    è¯·åˆ†ææˆ‘çš„éœ€æ±‚ï¼Œæä¾›ç»™æˆ‘å®Œæ•´çš„ä»£ç ï¼Œè°¢è°¢
    ```

- ä»£ç ç”Ÿæˆæç¤ºè¯2
```bash
    ç°åœ¨æœ‰Scraperé¡¹ç›®tikhub_tiktok_scraper
    å…¶ä¸­çˆ¬å–ç”¨æˆ·ä¸ªäººä¿¡æ¯æ•°æ®æ¥å£/api/v1/tiktok/web/fetch_user_profileçš„ä»£ç æ˜¯
    tikhub_tiktok_scraper/init_db.py
    # tikhub_tiktok_scraper/init_db.py
    import os
    import sys
    import logging
    from pathlib import Path
    from dotenv import load_dotenv
    
    # æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°ç³»ç»Ÿè·¯å¾„
    project_root = Path(__file__).parent
    sys.path.append(str(project_root))
    
    # é…ç½®æ—¥å¿—
    logging.basicConfig(level=logging.INFO)
    logger = logging.getLogger(__name__)
    
    def init_database():
        """åˆå§‹åŒ–æ•°æ®åº“è¡¨"""
        load_dotenv()
    
        database_url = os.getenv('DATABASE_URL')
        if not database_url:
            logger.error("æœªæ‰¾åˆ°DATABASE_URLç¯å¢ƒå˜é‡")
            return False
    
        try:
            from sqlalchemy import create_engine
            # ä½¿ç”¨æ­£ç¡®çš„å¯¼å…¥è·¯å¾„
            from tikhub_scraper.tikhub_scraper.items import Base
    
            engine = create_engine(database_url)
            Base.metadata.create_all(engine)
            logger.info("æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ")
            return True
        except ImportError as e:
            logger.error(f"å¯¼å…¥é”™è¯¯: {e}")
            logger.info("å½“å‰ç³»ç»Ÿè·¯å¾„:")
            for p in sys.path:
                logger.info(p)
            return False
        except Exception as e:
            logger.error(f"æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥: {e}")
            return False
    
    if __name__ == "__main__":
        logger.info(f"å½“å‰å·¥ä½œç›®å½•: {os.getcwd()}")
        logger.info(f"é¡¹ç›®æ ¹ç›®å½•: {project_root}")
        logger.info(f"ç³»ç»Ÿè·¯å¾„: {sys.path}")
        if init_database():
            logger.info("æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ")
        else:
            logger.error("æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥")
            sys.exit(1)
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/items.py
    # items.py
    import scrapy
    from sqlalchemy import Column, Integer, String, Text, DateTime, Boolean, BigInteger
    from sqlalchemy.ext.declarative import declarative_base
    from datetime import datetime
    
    Base = declarative_base()
    
    class TikTokUserItem(scrapy.Item):
        # ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
        user_id = scrapy.Field()
        short_id = scrapy.Field()
        unique_id = scrapy.Field()
        nickname = scrapy.Field()
        signature = scrapy.Field()
        avatar_larger = scrapy.Field()
        avatar_medium = scrapy.Field()
        avatar_thumb = scrapy.Field()
        create_time = scrapy.Field()
        verified = scrapy.Field()
        sec_uid = scrapy.Field()
        ftc = scrapy.Field()
        relation = scrapy.Field()
        open_favorite = scrapy.Field()
        comment_setting = scrapy.Field()
        commerce_user = scrapy.Field()
        duet_setting = scrapy.Field()
        stitch_setting = scrapy.Field()
        private_account = scrapy.Field()
        secret_account = scrapy.Field()
        is_ad_virtual = scrapy.Field()
        room_id = scrapy.Field()
        unique_id_modify_time = scrapy.Field()
        tt_seller = scrapy.Field()
        download_setting = scrapy.Field()
        show_music_tab = scrapy.Field()
        show_question_tab = scrapy.Field()
        show_playlist_tab = scrapy.Field()
        following_visibility = scrapy.Field()
        recommend_reason = scrapy.Field()
        now_invitation_card_url = scrapy.Field()
        nick_name_modify_time = scrapy.Field()
        is_embed_banned = scrapy.Field()
        can_exp_playlist = scrapy.Field()
        profile_embed_permission = scrapy.Field()
        language = scrapy.Field()
        suggest_account_bind = scrapy.Field()
        is_organization = scrapy.Field()
        user_story_status = scrapy.Field()
    
        # ç»Ÿè®¡æ•°æ®
        stats_follower_count = scrapy.Field()
        stats_following_count = scrapy.Field()
        stats_heart = scrapy.Field()
        stats_heart_count = scrapy.Field()
        stats_video_count = scrapy.Field()
        stats_digg_count = scrapy.Field()
        stats_friend_count = scrapy.Field()
    
        # ç»Ÿè®¡æ•°æ®V2
        stats_v2_follower_count = scrapy.Field()
        stats_v2_following_count = scrapy.Field()
        stats_v2_heart = scrapy.Field()
        stats_v2_heart_count = scrapy.Field()
        stats_v2_video_count = scrapy.Field()
        stats_v2_digg_count = scrapy.Field()
        stats_v2_friend_count = scrapy.Field()
    
        # åˆ†äº«å…ƒæ•°æ®
        share_title = scrapy.Field()
        share_desc = scrapy.Field()
    
        # çŠ¶æ€ä¿¡æ¯
        status_code = scrapy.Field()
        status_msg = scrapy.Field()
        need_fix = scrapy.Field()
    
        # æ—¶é—´æˆ³
        crawl_time = scrapy.Field()
    
    class TikTokUser(Base):
        __tablename__ = 'tiktok_users'
    
        id = Column(Integer, primary_key=True, autoincrement=True)
    
        # ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
        user_id = Column(String(50), nullable=False, unique=True)
        short_id = Column(String(50))
        unique_id = Column(String(100), nullable=False, index=True)
        nickname = Column(String(200))
        signature = Column(Text)
        avatar_larger = Column(Text)
        avatar_medium = Column(Text)
        avatar_thumb = Column(Text)
        create_time = Column(BigInteger, index=True)
        verified = Column(Boolean, default=False, index=True)
        sec_uid = Column(String(200), index=True)
        ftc = Column(Boolean, default=False)
        relation = Column(Integer, default=0)
        open_favorite = Column(Boolean, default=False)
        comment_setting = Column(Integer, default=0)
        commerce_user = Column(Boolean, default=False)
        duet_setting = Column(Integer, default=0)
        stitch_setting = Column(Integer, default=0)
        private_account = Column(Boolean, default=False)
        secret_account = Column(Boolean, default=False)
        is_ad_virtual = Column(Boolean, default=False)
        room_id = Column(String(100))
        unique_id_modify_time = Column(BigInteger, default=0)
        tt_seller = Column(Boolean, default=False)
        download_setting = Column(Integer, default=0)
        show_music_tab = Column(Boolean, default=False)
        show_question_tab = Column(Boolean, default=False)
        show_playlist_tab = Column(Boolean, default=False)
        following_visibility = Column(Integer, default=1)
        recommend_reason = Column(Text)
        now_invitation_card_url = Column(Text)
        nick_name_modify_time = Column(BigInteger, default=0)
        is_embed_banned = Column(Boolean, default=False)
        can_exp_playlist = Column(Boolean, default=False)
        profile_embed_permission = Column(Integer, default=1)
        language = Column(String(10), index=True)
        suggest_account_bind = Column(Boolean, default=False)
        is_organization = Column(Integer, default=0)
        user_story_status = Column(Integer, default=0)
    
        # ç»Ÿè®¡æ•°æ®
        stats_follower_count = Column(BigInteger, default=0)
        stats_following_count = Column(Integer, default=0)
        stats_heart = Column(BigInteger, default=0)
        stats_heart_count = Column(BigInteger, default=0)
        stats_video_count = Column(Integer, default=0)
        stats_digg_count = Column(Integer, default=0)
        stats_friend_count = Column(Integer, default=0)
    
        # ç»Ÿè®¡æ•°æ®V2
        stats_v2_follower_count = Column(BigInteger, default=0)
        stats_v2_following_count = Column(Integer, default=0)
        stats_v2_heart = Column(BigInteger, default=0)
        stats_v2_heart_count = Column(BigInteger, default=0)
        stats_v2_video_count = Column(Integer, default=0)
        stats_v2_digg_count = Column(Integer, default=0)
        stats_v2_friend_count = Column(Integer, default=0)
    
        # åˆ†äº«å…ƒæ•°æ®
        share_title = Column(Text)
        share_desc = Column(Text)
    
        # çŠ¶æ€ä¿¡æ¯
        status_code = Column(Integer, default=0)
        status_msg = Column(String(255))
        need_fix = Column(Boolean, default=False)
    
        # æ—¶é—´æˆ³
        crawl_time = Column(DateTime, default=datetime.utcnow, index=True)
        created_at = Column(DateTime, default=datetime.utcnow)
        updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/pipelines.py
    # tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/pipelines.py
    import logging
    from sqlalchemy.orm import sessionmaker
    from tikhub_scraper.items import TikTokUserItem, TikTokUser
    import os
    from dotenv import load_dotenv
    
    class TikTokUserPipeline:
        def __init__(self):
            self.engine = None
            self.Session = None
            self.logger = logging.getLogger(__name__)
    
        @classmethod
        def from_crawler(cls, crawler):
            pipeline = cls()
            pipeline.crawler = crawler
            return pipeline
    
        def open_spider(self, spider):
            """çˆ¬è™«å¼€å¯æ—¶è¿æ¥æ•°æ®åº“"""
            load_dotenv()
    
            database_url = os.getenv('DATABASE_URL')
            if not database_url:
                self.logger.error("æœªæ‰¾åˆ°DATABASE_URLç¯å¢ƒå˜é‡")
                return
    
            try:
                from sqlalchemy import create_engine
                self.engine = create_engine(database_url)
                self.Session = sessionmaker(bind=self.engine)
                self.logger.info("æ•°æ®åº“è¿æ¥æˆåŠŸ")
            except Exception as e:
                self.logger.error(f"æ•°æ®åº“è¿æ¥å¤±è´¥: {e}")
    
        def close_spider(self, spider):
            """çˆ¬è™«å…³é—­æ—¶æ–­å¼€æ•°æ®åº“è¿æ¥"""
            if self.engine:
                self.engine.dispose()
                self.logger.info("æ•°æ®åº“è¿æ¥å·²å…³é—­")
    
        def process_item(self, item, spider):
            """å¤„ç†çˆ¬å–çš„æ•°æ®é¡¹"""
            if not isinstance(item, TikTokUserItem):
                return item
    
            if not self.Session:
                self.logger.error("æ•°æ®åº“ä¼šè¯æœªåˆå§‹åŒ–")
                return item
    
            session = self.Session()
            try:
                # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨ï¼ˆåŸºäºuser_idï¼‰
                existing_user = session.query(TikTokUser).filter_by(
                    user_id=item['user_id']
                ).first()
    
                if existing_user:
                    # æ›´æ–°ç°æœ‰ç”¨æˆ· - æ›´æ–°æ‰€æœ‰å­—æ®µ
                    for field in item.fields:
                        if hasattr(existing_user, field) and field in item:
                            setattr(existing_user, field, item[field])
    
                    self.logger.info(f"æ›´æ–°ç”¨æˆ·æ•°æ®: {item['unique_id']}")
                else:
                    # åˆ›å»ºæ–°ç”¨æˆ·è®°å½•
                    user_data = {}
                    for field in item.fields:
                        if field in item:
                            user_data[field] = item[field]
    
                    user = TikTokUser(**user_data)
                    session.add(user)
                    self.logger.info(f"æ–°å¢ç”¨æˆ·æ•°æ®: {item['unique_id']}")
    
                session.commit()
    
            except Exception as e:
                session.rollback()
                self.logger.error(f"ä¿å­˜ç”¨æˆ·æ•°æ®å¤±è´¥: {e}")
            finally:
                session.close()
    
            return item
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/spiders/tiktok_profile_spider.py
    # tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/spiders/tiktok_profile_spider.py
    import scrapy
    import json
    from urllib.parse import urlencode
    from tikhub_scraper.items import TikTokUserItem
    from datetime import datetime
    import os
    import logging
    
    class JSONLogger:
        """JSONå“åº”æ—¥å¿—è®°å½•å™¨"""
    
        def __init__(self, spider_name, log_dir="json_logs"):
            self.spider_name = spider_name
            self.log_dir = log_dir
            self.logger = logging.getLogger(__name__)
    
            # åˆ›å»ºæ—¥å¿—ç›®å½•
            if not os.path.exists(self.log_dir):
                os.makedirs(self.log_dir)
                self.logger.info(f"åˆ›å»ºJSONæ—¥å¿—ç›®å½•: {self.log_dir}")
    
        def save_response(self, username, response_data, success=True):
            """ä¿å­˜APIå“åº”åˆ°JSONæ–‡ä»¶"""
            try:
                # ç”Ÿæˆæ–‡ä»¶å
                timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
                status = "success" if success else "error"
                filename = f"{timestamp}_{username}_{status}.json"
                filepath = os.path.join(self.log_dir, filename)
    
                # ä¿å­˜JSONæ–‡ä»¶
                with open(filepath, 'w', encoding='utf-8') as f:
                    json.dump(response_data, f, ensure_ascii=False, indent=2)
    
                self.logger.debug(f"å·²ä¿å­˜JSONå“åº”: {filepath}")
                return filepath
    
            except Exception as e:
                self.logger.error(f"ä¿å­˜JSONå“åº”å¤±è´¥: {e}")
                return None
    
        def save_error_response(self, username, error_info, request_url=None):
            """ä¿å­˜é”™è¯¯ä¿¡æ¯åˆ°JSONæ–‡ä»¶"""
            error_data = {
                "timestamp": datetime.now().isoformat(),
                "username": username,
                "error": str(error_info),
                "request_url": request_url,
                "success": False
            }
    
            return self.save_response(username, error_data, success=False)
    
    class TikTokProfileSpider(scrapy.Spider):
        name = 'tiktok_profile'
        allowed_domains = ['api.tikhub.io']
    
        def __init__(self, *args, **kwargs):
            super().__init__(*args, **kwargs)
            # åˆå§‹åŒ–JSONæ—¥å¿—è®°å½•å™¨
            self.json_logger = JSONLogger(self.name)
    
        # è¦çˆ¬å–çš„ç”¨æˆ·åˆ—è¡¨
        users_to_scrape = [
            {'uniqueId': 'anuwattiktok', 'secUid': ''},
        ]
    
        def start_requests(self):
            """ç”Ÿæˆåˆå§‹è¯·æ±‚"""
            base_url = '<https://api.tikhub.io/api/v1/tiktok/web/fetch_user_profile>'
    
            for user in self.users_to_scrape:
                params = {k: v for k, v in user.items() if v and v != 'null'}
                url = f"{base_url}?{urlencode(params)}"
    
                self.logger.info(f"å‡†å¤‡çˆ¬å–ç”¨æˆ·: {user.get('uniqueId', 'Unknown')}")
    
                yield scrapy.Request(
                    url=url,
                    callback=self.parse,
                    meta={'user_info': user},
                    errback=self.handle_error
                )
    
        def parse(self, response):
            """è§£æAPIå“åº”"""
            user_info = response.meta['user_info']
            username = user_info.get('uniqueId', 'Unknown')
    
            if response.status != 200:
                self.logger.error(f"è¯·æ±‚å¤±è´¥: çŠ¶æ€ç  {response.status}")
                return
    
            try:
                data = json.loads(response.text)
    
                # ä¿å­˜åŸå§‹APIå“åº”åˆ°JSONæ–‡ä»¶
                json_filepath = self.json_logger.save_response(username, data)
                if json_filepath:
                    self.logger.info(f"å·²ä¿å­˜APIå“åº”åˆ°: {json_filepath}")
    
                if data.get('code') == 200 and data.get('data'):
                    api_data = data['data']
                    user_info_data = api_data.get('userInfo', {})
                    user = user_info_data.get('user', {})
                    stats = user_info_data.get('stats', {})
                    stats_v2 = user_info_data.get('statsV2', {})
                    share_meta = api_data.get('shareMeta', {})
    
                    item = TikTokUserItem()
    
                    # æ•°æ®è½¬æ¢å‡½æ•°
                    def safe_int_convert(value, default=0):
                        if value is None:
                            return default
                        try:
                            if isinstance(value, str):
                                value = value.replace(',', '')
                                return int(value) if value.strip() else default
                            elif isinstance(value, (int, float)):
                                return int(value)
                            return default
                        except (ValueError, TypeError):
                            return default
    
                    def safe_bool_convert(value, default=False):
                        if value is None:
                            return default
                        return bool(value)
    
                    # ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
                    item['user_id'] = user.get('id', '')
                    item['short_id'] = user.get('shortId', '')
                    item['unique_id'] = user.get('uniqueId', '') or username
                    item['nickname'] = user.get('nickname', '')
                    item['signature'] = user.get('signature', '')
                    item['avatar_larger'] = user.get('avatarLarger', '')
                    item['avatar_medium'] = user.get('avatarMedium', '')
                    item['avatar_thumb'] = user.get('avatarThumb', '')
                    item['create_time'] = safe_int_convert(user.get('createTime'))
                    item['verified'] = safe_bool_convert(user.get('verified'))
                    item['sec_uid'] = user.get('secUid', '')
                    item['ftc'] = safe_bool_convert(user.get('ftc'))
                    item['relation'] = safe_int_convert(user.get('relation'))
                    item['open_favorite'] = safe_bool_convert(user.get('openFavorite'))
                    item['comment_setting'] = safe_int_convert(user.get('commentSetting'))
    
                    # å•†ä¸šç”¨æˆ·ä¿¡æ¯
                    commerce_info = user.get('commerceUserInfo', {})
                    item['commerce_user'] = safe_bool_convert(commerce_info.get('commerceUser'))
    
                    item['duet_setting'] = safe_int_convert(user.get('duetSetting'))
                    item['stitch_setting'] = safe_int_convert(user.get('stitchSetting'))
                    item['private_account'] = safe_bool_convert(user.get('privateAccount'))
                    item['secret_account'] = safe_bool_convert(user.get('secret'))
                    item['is_ad_virtual'] = safe_bool_convert(user.get('isADVirtual'))
                    item['room_id'] = user.get('roomId', '')
                    item['unique_id_modify_time'] = safe_int_convert(user.get('uniqueIdModifyTime'))
                    item['tt_seller'] = safe_bool_convert(user.get('ttSeller'))
                    item['download_setting'] = safe_int_convert(user.get('downloadSetting'))
    
                    # ä¸ªäººèµ„æ–™æ ‡ç­¾è®¾ç½®
                    profile_tab = user.get('profileTab', {})
                    item['show_music_tab'] = safe_bool_convert(profile_tab.get('showMusicTab'))
                    item['show_question_tab'] = safe_bool_convert(profile_tab.get('showQuestionTab'))
                    item['show_playlist_tab'] = safe_bool_convert(profile_tab.get('showPlayListTab'))
    
                    item['following_visibility'] = safe_int_convert(user.get('followingVisibility'))
                    item['recommend_reason'] = user.get('recommendReason', '')
                    item['now_invitation_card_url'] = user.get('nowInvitationCardUrl', '')
                    item['nick_name_modify_time'] = safe_int_convert(user.get('nickNameModifyTime'))
                    item['is_embed_banned'] = safe_bool_convert(user.get('isEmbedBanned'))
                    item['can_exp_playlist'] = safe_bool_convert(user.get('canExpPlaylist'))
                    item['profile_embed_permission'] = safe_int_convert(user.get('profileEmbedPermission'))
                    item['language'] = user.get('language', '')
                    item['suggest_account_bind'] = safe_bool_convert(user.get('suggestAccountBind'))
                    item['is_organization'] = safe_int_convert(user.get('isOrganization'))
                    item['user_story_status'] = safe_int_convert(user.get('UserStoryStatus'))
    
                    # ç»Ÿè®¡æ•°æ®
                    item['stats_follower_count'] = safe_int_convert(stats.get('followerCount'))
                    item['stats_following_count'] = safe_int_convert(stats.get('followingCount'))
                    item['stats_heart'] = safe_int_convert(stats.get('heart'))
                    item['stats_heart_count'] = safe_int_convert(stats.get('heartCount'))
                    item['stats_video_count'] = safe_int_convert(stats.get('videoCount'))
                    item['stats_digg_count'] = safe_int_convert(stats.get('diggCount'))
                    item['stats_friend_count'] = safe_int_convert(stats.get('friendCount'))
    
                    # ç»Ÿè®¡æ•°æ®V2
                    item['stats_v2_follower_count'] = safe_int_convert(stats_v2.get('followerCount'))
                    item['stats_v2_following_count'] = safe_int_convert(stats_v2.get('followingCount'))
                    item['stats_v2_heart'] = safe_int_convert(stats_v2.get('heart'))
                    item['stats_v2_heart_count'] = safe_int_convert(stats_v2.get('heartCount'))
                    item['stats_v2_video_count'] = safe_int_convert(stats_v2.get('videoCount'))
                    item['stats_v2_digg_count'] = safe_int_convert(stats_v2.get('diggCount'))
                    item['stats_v2_friend_count'] = safe_int_convert(stats_v2.get('friendCount'))
    
                    # åˆ†äº«å…ƒæ•°æ®
                    item['share_title'] = share_meta.get('title', '')
                    item['share_desc'] = share_meta.get('desc', '')
    
                    # çŠ¶æ€ä¿¡æ¯
                    item['status_code'] = safe_int_convert(api_data.get('statusCode'))
                    item['status_msg'] = api_data.get('statusMsg', '')
                    item['need_fix'] = safe_bool_convert(api_data.get('needFix'))
    
                    # æ—¶é—´æˆ³
                    item['crawl_time'] = datetime.utcnow()
    
                    self.logger.info(f"æˆåŠŸçˆ¬å–ç”¨æˆ·: {item['unique_id']} - {item['nickname']}")
                    yield item
    
                else:
                    error_msg = data.get('message', 'Unknown error')
                    self.logger.error(f"APIå“åº”é”™è¯¯: {error_msg} - ç”¨æˆ·: {username}")
    
            except Exception as e:
                self.logger.error(f"è§£æç”¨æˆ·æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯: {e} - ç”¨æˆ·: {username}")
    
        def handle_error(self, failure):
            """å¤„ç†è¯·æ±‚é”™è¯¯"""
            self.logger.error(f"è¯·æ±‚å¤±è´¥: {failure.value}")
    
            # è·å–è¯·æ±‚ä¿¡æ¯
            request = failure.request
            user_info = request.meta.get('user_info', {})
            username = user_info.get('uniqueId', 'Unknown')
    
            self.logger.error(f"å¤±è´¥çš„URL: {request.url}")
    
            # ä¿å­˜é”™è¯¯ä¿¡æ¯åˆ°JSONæ–‡ä»¶
            error_data = {
                "timestamp": datetime.now().isoformat(),
                "username": username,
                "error": str(failure.value),
                "request_url": request.url,
                "request_headers": dict(request.headers)
            }
            self.json_logger.save_response(username, error_data, success=False)
    è¯·å‚è€ƒä¸Šæ–¹ä»£ç å¸®æˆ‘ç”Ÿæˆ
    # è·å–ç”¨æˆ·å‘å¸–/Get user postæ¥å£
    conn.request("GET", "/api/v1/twitter/web/fetch_user_post_tweet?screen_name=Kitti3Miti&cursor=null", payload, headers)
    é›†æˆåˆ°ä¹‹å‰ä½¿ç”¨scraperå¼€å‘çš„tikhub_tiktok_scraperé¡¹ç›®å½“ä¸­å»ï¼Œ
    æ¥å£å¾—åˆ°çš„å“åº”å€¼æ˜¯fetch_user_post_tweet.jsonæ–‡ä»¶
    ä¿å­˜æ•°æ®çš„æ•°æ®è¡¨ç»“æ„æ˜¯
    -- Xç”¨æˆ·åŸºæœ¬ä¿¡æ¯è¡¨
    CREATE TABLE x_users (
        id INT AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®IDï¼Œè‡ªå¢é•¿',
        
        -- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
        rest_id VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·å”¯ä¸€ID',
        screen_name VARCHAR(100) NOT NULL COMMENT 'ç”¨æˆ·å',
        name VARCHAR(200) COMMENT 'ç”¨æˆ·æ˜¾ç¤ºåç§°',
        avatar TEXT COMMENT 'å¤´åƒURL',
        header_image TEXT COMMENT 'å¤´å›¾URL',
        description TEXT COMMENT 'ç”¨æˆ·æè¿°',
        location VARCHAR(500) COMMENT 'ç”¨æˆ·ä½ç½®',
        blue_verified BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦è“æ ‡è®¤è¯',
        verification_type VARCHAR(100) COMMENT 'è®¤è¯ç±»å‹',
        protected BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å—ä¿æŠ¤è´¦å·',
        
        -- ç»Ÿè®¡ä¿¡æ¯
        friends_count INT DEFAULT 0 COMMENT 'å…³æ³¨æ•°',
        sub_count INT DEFAULT 0 COMMENT 'è®¢é˜…æ•°/ç²‰ä¸æ•°',
        statuses_count INT DEFAULT 0 COMMENT 'æ¨æ–‡æ€»æ•°',
        media_count INT DEFAULT 0 COMMENT 'åª’ä½“æ•°',
        
        -- æ—¶é—´ä¿¡æ¯
        created_at VARCHAR(100) COMMENT 'è´¦å·åˆ›å»ºæ—¶é—´',
        pinned_tweet_ids JSON COMMENT 'ç½®é¡¶æ¨æ–‡IDåˆ—è¡¨',
        
        -- ç³»ç»Ÿå­—æ®µ
        crawl_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ•°æ®çˆ¬å–æ—¶é—´',
        created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'è®°å½•åˆ›å»ºæ—¶é—´',
        updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'è®°å½•æ›´æ–°æ—¶é—´',
        
        -- ç´¢å¼•
        INDEX idx_rest_id (rest_id),
        INDEX idx_screen_name (screen_name),
        INDEX idx_blue_verified (blue_verified),
        INDEX idx_created_at (created_at),
        INDEX idx_crawl_time (crawl_time)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Xç”¨æˆ·åŸºæœ¬ä¿¡æ¯è¡¨';
    
    -- Xç”¨æˆ·æ¨æ–‡æ•°æ®è¡¨
    CREATE TABLE x_user_tweets (
        id INT AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®IDï¼Œè‡ªå¢é•¿',
        
        -- å…³è”ä¿¡æ¯
        rest_id VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·ID',
        tweet_id VARCHAR(50) NOT NULL COMMENT 'æ¨æ–‡å”¯ä¸€ID',
        conversation_id VARCHAR(50) COMMENT 'å¯¹è¯ID',
        
        -- æ¨æ–‡å†…å®¹
        text TEXT COMMENT 'æ¨æ–‡å†…å®¹',
        lang VARCHAR(10) COMMENT 'è¯­è¨€ä»£ç ',
        source TEXT COMMENT 'å‘å¸ƒæ¥æº',
        
        -- äº’åŠ¨æ•°æ®
        bookmarks INT DEFAULT 0 COMMENT 'ä¹¦ç­¾æ•°',
        favorites INT DEFAULT 0 COMMENT 'å–œæ¬¢æ•°',
        views VARCHAR(50) COMMENT 'æµè§ˆæ•°',
        quotes INT DEFAULT 0 COMMENT 'å¼•ç”¨æ•°',
        replies INT DEFAULT 0 COMMENT 'å›å¤æ•°',
        retweets INT DEFAULT 0 COMMENT 'è½¬å‘æ•°',
        
        -- å®ä½“ä¿¡æ¯
        entities JSON COMMENT 'æ¨æ–‡å®ä½“ï¼ˆæ ‡ç­¾ã€æåŠç­‰ï¼‰',
        
        -- åª’ä½“ä¿¡æ¯
        media JSON COMMENT 'åª’ä½“å†…å®¹ï¼ˆå›¾ç‰‡ã€è§†é¢‘ç­‰ï¼‰',
        
        -- è½¬æ¨ä¿¡æ¯
        is_retweet BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦æ˜¯è½¬æ¨',
        retweeted_tweet JSON COMMENT 'åŸæ¨æ–‡ä¿¡æ¯',
        
        -- æ—¶é—´ä¿¡æ¯
        created_at VARCHAR(100) COMMENT 'æ¨æ–‡åˆ›å»ºæ—¶é—´',
        
        -- ç³»ç»Ÿå­—æ®µ
        crawl_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ•°æ®çˆ¬å–æ—¶é—´',
        created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'è®°å½•åˆ›å»ºæ—¶é—´',
        
        -- ç´¢å¼•
        UNIQUE KEY uk_tweet_user (tweet_id, rest_id),
        INDEX idx_rest_id (rest_id),
        INDEX idx_tweet_id (tweet_id),
        INDEX idx_conversation_id (conversation_id),
        INDEX idx_created_at (created_at),
        INDEX idx_is_retweet (is_retweet),
        INDEX idx_crawl_time (crawl_time)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Xç”¨æˆ·æ¨æ–‡æ•°æ®è¡¨';
    
    -- Xç”¨æˆ·åˆ†é¡µæ¸¸æ ‡è¡¨ï¼ˆæ–°å¢ï¼‰
    CREATE TABLE x_user_cursors (
        id INT AUTO_INCREMENT PRIMARY KEY COMMENT 'ä¸»é”®IDï¼Œè‡ªå¢é•¿',
        
        -- å…³è”ä¿¡æ¯
        rest_id VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·ID',
        screen_name VARCHAR(100) COMMENT 'ç”¨æˆ·å',
        
        -- è¯·æ±‚å‚æ•°
        request_screen_name VARCHAR(100) COMMENT 'è¯·æ±‚æ—¶çš„ç”¨æˆ·å',
        request_rest_id VARCHAR(50) COMMENT 'è¯·æ±‚æ—¶çš„ç”¨æˆ·ID',
        request_cursor VARCHAR(500) COMMENT 'è¯·æ±‚æ—¶çš„æ¸¸æ ‡',
        
        -- å“åº”æ¸¸æ ‡ä¿¡æ¯
        next_cursor VARCHAR(500) COMMENT 'ä¸‹ä¸€é¡µæ¸¸æ ‡',
        prev_cursor VARCHAR(500) COMMENT 'ä¸Šä¸€é¡µæ¸¸æ ‡',
        
        -- åˆ†é¡µçŠ¶æ€
        has_next_page BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ',
        has_prev_page BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦æœ‰ä¸Šä¸€é¡µ',
        
        -- æ‰¹æ¬¡ä¿¡æ¯
        batch_size INT DEFAULT 0 COMMENT 'æœ¬æ‰¹æ¬¡æ¨æ–‡æ•°é‡',
        total_tweets INT DEFAULT 0 COMMENT 'ç´¯è®¡æ¨æ–‡æ•°é‡',
        
        -- è¯·æ±‚å…ƒæ•°æ®
        request_params JSON COMMENT 'å®Œæ•´è¯·æ±‚å‚æ•°',
        response_status VARCHAR(50) COMMENT 'å“åº”çŠ¶æ€',
        
        -- ç³»ç»Ÿå­—æ®µ
        crawl_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ•°æ®çˆ¬å–æ—¶é—´',
        created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'è®°å½•åˆ›å»ºæ—¶é—´',
        
        -- ç´¢å¼•
        INDEX idx_rest_id (rest_id),
        INDEX idx_screen_name (screen_name),
        INDEX idx_request_cursor (request_cursor(100)),
        INDEX idx_next_cursor (next_cursor(100)),
        INDEX idx_prev_cursor (prev_cursor(100)),
        INDEX idx_crawl_time (crawl_time),
        INDEX idx_has_next_page (has_next_page)
    ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Xç”¨æˆ·åˆ†é¡µæ¸¸æ ‡è¡¨';
    è¯·åˆ†ææˆ‘çš„éœ€æ±‚ï¼Œæä¾›ç»™æˆ‘å®Œæ•´çš„ä»£ç ï¼Œè°¢è°¢
    ```

- ä»£ç ç”Ÿæˆæç¤ºè¯3
```bash
    ç°åœ¨çš„ä»£ç è¿è¡Œçˆ¬è™«çš„å‘½ä»¤æ˜¯
    è·å–ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯
      scrapy crawl tiktok_profile
      
    è·å–ç”¨æˆ·çš„ä½œå“åˆ—è¡¨
      scrapy crawl tiktok_posts
      
    è·å–å•ä¸ªä½œå“æ•°æ®
      scrapy crawl tiktok_video
      
    è·å–xå¹³å°ç”¨æˆ·æ•°æ®
      scrapy crawl x_user_post
      
    instagramå¹³å°æ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ·æ•°æ®
      scrapy crawl instagram_tagged
      
    æ ¹æ®ç”¨æˆ·åè·å–Taggedä½œå“åˆ—è¡¨æ•°æ®
      scrapy crawl instagram_tagged_posts
    
    tiktokçˆ¬å–ç¨‹åºçš„æ‰§è¡Œé¡ºåºåº”è¯¥æ˜¯
    è·å–ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ â€”â€” scrapy crawl tiktok_profile
      
    è·å–ç”¨æˆ·çš„ä½œå“åˆ—è¡¨ â€”â€” scrapy crawl tiktok_posts
      
    è·å–å•ä¸ªä½œå“æ•°æ® â€”â€” scrapy crawl tiktok_video
    
    ========================================================================================================================
    
    ç°åœ¨â€œè·å–ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯â€çš„ä»£ç ç¨‹åºæ˜¯
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/spiders/tiktok_profile_spider.py
    
    è¦çˆ¬å–çš„ç”¨æˆ·åˆ—è¡¨åœ¨ä»£ç ä¸­å®šä¹‰
    # è¦çˆ¬å–çš„ç”¨æˆ·åˆ—è¡¨
    users_to_scrape = [
        {'uniqueId': 'anuwattiktok', 'secUid': ''},
        {'uniqueId': 'iamsasamsumday', 'secUid': ''},
        {'uniqueId': 'realdonaldtrump', 'secUid': ''},
    ]
    
    æˆ‘æƒ³ä¿®æ”¹ä¸ºåœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­å®šä¹‰éœ€è¦çˆ¬å–çš„ç”¨æˆ·çš„æ•°æ®
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/leaders/tiktok.json
    uniqueIdå¯¹åº”jsonä¸­çš„userNameå­—æ®µ
    
    ========================================================================================================================
    
    ========================================================================================================================
    
    è·å–ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ â€”â€” scrapy crawl tiktok_profileçˆ¬å–åˆ°çš„æ•°æ®ä¿å­˜åˆ°äº†æ•°æ®è¡¨tiktok_userså½“ä¸­
    
    ç°åœ¨â€œè·å–ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯â€çš„ä»£ç ç¨‹åºæ˜¯
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/spiders/tiktok_posts_spider.py
    è¦çˆ¬å–çš„ç”¨æˆ·åˆ—è¡¨åœ¨ä»£ç ä¸­å®šä¹‰
    # è¦çˆ¬å–çš„ç”¨æˆ·åˆ—è¡¨
    users_to_scrape = [
        {'secUid': 'MS4wLjABAAAAxxOtCTXC_MU05vPqMKPMcN2ZoI1m7mEbnyNSw4AmEyyqChIQH7zCDsXnjYAsSKq1',
          'uniqueId': 'realdonaldtrump'},
    ]
    æˆ‘æƒ³è¦ä¿®æ”¹ä¸ºä»tiktok_usersæ•°æ®è¡¨å½“ä¸­è·å–ç”¨æˆ·çš„secUidå’ŒuniqueIdï¼ˆå¯¹åº”æ•°æ®è¡¨ä¸­çš„sec_uidã€unique_idå­—æ®µï¼‰ï¼Œè¯·å¸®æˆ‘ä¿®æ”¹ä»£ç 
    
    ========================================================================================================================
    
    ========================================================================================================================
    
    è·å–ç”¨æˆ·çš„ä½œå“åˆ—è¡¨ â€”â€” scrapy crawl tiktok_postsçˆ¬å–åˆ°çš„æ•°æ®ä¿å­˜åˆ°äº†æ•°æ®è¡¨tiktok_user_postså½“ä¸­
    
    ç°åœ¨â€œè·å–å•ä¸ªä½œå“æ•°æ®â€çš„ä»£ç ç¨‹åºæ˜¯
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/spiders/tiktok_video_spider.py
    # è¦çˆ¬å–çš„è§†é¢‘IDåˆ—è¡¨
    videos_to_scrape = [
        {'itemId': '7558116309083475230'},
    ]
    æˆ‘æƒ³è¦ä¿®æ”¹ä¸ºä»tiktok_user_postsæ•°æ®è¡¨å½“ä¸­è·å–è§†é¢‘çš„itemIdï¼ˆå¯¹åº”æ•°æ®è¡¨ä¸­çš„aweme_idå­—æ®µï¼‰ï¼Œè¯·å¸®æˆ‘ä¿®æ”¹ä»£ç 
    
    ========================================================================================================================
    
    ========================================================================================================================
    
    è·å–å•ä¸ªä½œå“æ•°æ® â€”â€” scrapy crawl tiktok_videoçˆ¬å–åˆ°çš„æ•°æ®ä¿å­˜åˆ°äº†æ•°æ®è¡¨tiktok_videoså½“ä¸­
    
    ç°åœ¨å°†è§†é¢‘ä¸‹è½½åˆ°æœ¬åœ°çš„ä»£ç ç¨‹åºæ˜¯
    import requests
    import os
    import time
    from urllib.parse import unquote, urlparse
    
    def download_tiktok_video():
        # ç¬¬ä¸€æ­¥ï¼šé…ç½®åˆå§‹è¯·æ±‚å‚æ•°
        play_url = "<https://www.tiktok.com/aweme/v1/play/?faid=1988&file_id=a01cbb572d06426a88739f80a7b6658f&is_play_url=1&item_id=7558116309083475230&line=0&ply_type=2&signaturev3=dmlkZW9faWQ7ZmlsZV9pZDtpdGVtX2lkLjlhMmY4MDA2ZjNkODQ2YWJkMWE3N2YxZmQ5YTM2NDJi&tk=tt_chain_token&video_id=v15044gf0000d3ht2cfog65khl9o0bv0>"
        tt_chain_token = "tt_chain_token=YHRC0wiFZJTjYOoseWfnog==;"
    
        # ç¬¬äºŒæ­¥ï¼šè®¾ç½®è¯·æ±‚å¤´
        headers = {
            'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
            'accept-language': 'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6',
            'priority': 'u=0, i',
            'referer': '<https://www.tiktok.com/>',
            'sec-ch-ua': '"Chromium";v="142", "Microsoft Edge";v="142", "Not_A Brand";v="99"',
            'sec-ch-ua-mobile': '?0',
            'sec-ch-ua-platform': '"Windows"',
            'sec-fetch-dest': 'document',
            'sec-fetch-mode': 'navigate',
            'sec-fetch-site': 'none',
            'sec-fetch-user': '?1',
            'upgrade-insecure-requests': '1',
            'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36 Edg/142.0.0.0'
        }
    
        # ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®cookies
        cookies = {
            'tt_chain_token': tt_chain_token
        }
    
        # ç¬¬å››æ­¥ï¼šåˆ›å»ºsessionä¿æŒè¿æ¥
        session = requests.Session()
    
        print("ç¬¬ä¸€æ­¥ï¼šè·å–è§†é¢‘é‡å®šå‘é“¾æ¥...")
        try:
            # ç¬¬äº”æ­¥ï¼šå‘é€åˆå§‹è¯·æ±‚è·å–é‡å®šå‘é“¾æ¥
            response = session.get(
                play_url,
                headers=headers,
                cookies=cookies,
                allow_redirects=False  # ä¸è‡ªåŠ¨é‡å®šå‘
            )
    
            # ç¬¬å…­æ­¥ï¼šæ£€æŸ¥å“åº”çŠ¶æ€
            if response.status_code in (301, 302, 303, 307, 308):
                # ç¬¬ä¸ƒæ­¥ï¼šè·å–é‡å®šå‘é“¾æ¥
                redirect_url = response.headers.get('Location')
                if redirect_url:
                    print(f"âœ… æˆåŠŸè·å–é‡å®šå‘é“¾æ¥: {redirect_url}")
    
                    # ç¬¬å…«æ­¥ï¼šä¸‹è½½è§†é¢‘
                    return download_video(session, redirect_url, headers, cookies)
                else:
                    print("âŒ é”™è¯¯: æœªæ‰¾åˆ°é‡å®šå‘é“¾æ¥")
                    return False
            else:
                print(f"âŒ é”™è¯¯: æœŸæœ›é‡å®šå‘å“åº”ï¼Œä½†å¾—åˆ°çŠ¶æ€ç  {response.status_code}")
                print(f"å“åº”å¤´: {dict(response.headers)}")
                return False
    
        except Exception as e:
            print(f"âŒ è¯·æ±‚è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: {e}")
            return False
    
    def download_video(session, video_url, headers, cookies):
        print("ç¬¬äºŒæ­¥ï¼šå¼€å§‹ä¸‹è½½è§†é¢‘...")
        try:
            # ç¬¬ä¹æ­¥ï¼šå‘é€è§†é¢‘ä¸‹è½½è¯·æ±‚
            response = session.get(
                video_url,
                headers=headers,
                cookies=cookies,
                stream=True  # æµå¼ä¸‹è½½
            )
    
            if response.status_code == 200:
                # ç¬¬åæ­¥ï¼šç”Ÿæˆæ–‡ä»¶å
                timestamp = int(time.time())
                filename = f"tiktok_video_{timestamp}.mp4"
    
                # ç¬¬åä¸€æ­¥ï¼šè·å–æ–‡ä»¶å¤§å°
                file_size = int(response.headers.get('content-length', 0))
                print(f"ğŸ“Š è§†é¢‘å¤§å°: {file_size / 1024 / 1024:.2f} MB")
    
                # ç¬¬åäºŒæ­¥ï¼šä¸‹è½½è§†é¢‘
                downloaded_size = 0
                start_time = time.time()
    
                with open(filename, 'wb') as f:
                    for chunk in response.iter_content(chunk_size=8192):
                        if chunk:
                            f.write(chunk)
                            downloaded_size += len(chunk)
    
                            # æ˜¾ç¤ºä¸‹è½½è¿›åº¦
                            if file_size > 0:
                                progress = (downloaded_size / file_size) * 100
                                elapsed_time = time.time() - start_time
                                if elapsed_time > 0:
                                    speed = downloaded_size / elapsed_time / 1024  # KB/s
                                    eta = (file_size - downloaded_size) / (
                                                downloaded_size / elapsed_time) if downloaded_size > 0 else 0
                                    print(f"\\rğŸ“¥ è¿›åº¦: {progress:.1f}% | é€Ÿåº¦: {speed:.1f} KB/s | å‰©ä½™: {eta:.1f}s", end='',
                                          flush=True)
    
                print(f"\\nâœ… è§†é¢‘å·²æˆåŠŸä¸‹è½½åˆ°: {filename}")
                return True
            else:
                print(f"âŒ ä¸‹è½½å¤±è´¥ï¼ŒçŠ¶æ€ç : {response.status_code}")
                return False
    
        except Exception as e:
            print(f"âŒ è§†é¢‘ä¸‹è½½è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: {e}")
            return False
    
    if __name__ == "__main__":
        print("=" * 60)
        print("TikTokè§†é¢‘ä¸‹è½½ç¨‹åº")
        print("=" * 60)
    
        # æ‰§è¡Œä¸‹è½½
        success = download_tiktok_video()
    
        if success:
            print("ğŸ‰ ä¸‹è½½å®Œæˆï¼")
        else:
            print("ğŸ’¥ ä¸‹è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–å‚æ•°è®¾ç½®")
    
    æˆ‘æƒ³è¦ä¿®æ”¹ä¸ºä»tiktok_videosæ•°æ®è¡¨å½“ä¸­è·å–è§†é¢‘çš„play_urlã€tt_chain_tokenï¼ˆå¯¹åº”æ•°æ®è¡¨ä¸­çš„video_play_addr3ã€cookieå­—æ®µï¼‰ï¼Œè¯·å¸®æˆ‘ä¿®æ”¹ä»£ç 
    
    ========================================================================================================================
    
    ========================================================================================================================
    
    ç°åœ¨â€œè·å–xå¹³å°ç”¨æˆ·æ•°æ®â€çš„ä»£ç ç¨‹åºæ˜¯
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/spiders/x_user_post_spider.py
    
    è¦çˆ¬å–çš„ç”¨æˆ·åˆ—è¡¨åœ¨ä»£ç ä¸­å®šä¹‰
    # è¦çˆ¬å–çš„ç”¨æˆ·åˆ—è¡¨
    users_to_scrape = [
        {'screen_name': 'Kitti3Miti', 'rest_id': ''},
    ]
    
    æˆ‘æƒ³ä¿®æ”¹ä¸ºåœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­å®šä¹‰éœ€è¦çˆ¬å–çš„ç”¨æˆ·çš„æ•°æ®
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/leaders/x.json
    screen_nameå¯¹åº”jsonä¸­çš„userNameå­—æ®µ
    
    ========================================================================================================================
    
    ========================================================================================================================
    
    ç°åœ¨â€œinstagramå¹³å°æ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ·æ•°æ®â€çš„ä»£ç ç¨‹åºæ˜¯
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/spiders/instagram_profile_spider.py
    
    è¦çˆ¬å–çš„ç”¨æˆ·åˆ—è¡¨åœ¨ä»£ç ä¸­å®šä¹‰
    # è¦çˆ¬å–çš„Instagramç”¨æˆ·åˆ—è¡¨
    users_to_scrape = [
        'jacksonwang852g7',
        # å¯ä»¥æ·»åŠ æ›´å¤šç”¨æˆ·å
    ]
    
    æˆ‘æƒ³ä¿®æ”¹ä¸ºåœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­å®šä¹‰éœ€è¦çˆ¬å–çš„ç”¨æˆ·çš„æ•°æ®
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/leaders/instagram.json
    éœ€è¦çš„ç”¨æˆ·åå¯¹åº”jsonä¸­çš„userNameå­—æ®µ
    
    ========================================================================================================================
    
    ========================================================================================================================
    
    instagramå¹³å°æ ¹æ®ç”¨æˆ·åè·å–ç”¨æˆ·æ•°æ® â€”â€” scrapy crawl instagram_taggedçˆ¬å–åˆ°çš„æ•°æ®ä¿å­˜åˆ°äº†æ•°æ®è¡¨instagram_userså½“ä¸­
    
    ç°åœ¨â€œæ ¹æ®ç”¨æˆ·åè·å–Taggedä½œå“åˆ—è¡¨æ•°æ®â€çš„ä»£ç ç¨‹åºæ˜¯
    tikhub_tiktok_scraper/tikhub_scraper/tikhub_scraper/spiders/instagram_tagged_posts_spider.py
    è¦çˆ¬å–çš„ç”¨æˆ·åˆ—è¡¨åœ¨ä»£ç ä¸­å®šä¹‰
    # è¦çˆ¬å–çš„ç”¨æˆ·åˆ—è¡¨
    users_to_scrape = [
        {'username': 'lucas_xx444'},
    ]
    æˆ‘æƒ³è¦ä¿®æ”¹ä¸ºä»instagram_usersæ•°æ®è¡¨å½“ä¸­è·å–ç”¨æˆ·çš„usernameï¼ˆå¯¹åº”æ•°æ®è¡¨ä¸­çš„usernameå­—æ®µï¼‰ï¼Œè¯·å¸®æˆ‘ä¿®æ”¹ä»£ç 
    
    ========================================================================================================================
    ```

